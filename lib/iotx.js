"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Iotx = void 0;

var _accounts = require("./account/accounts");

var _method = require("./action/method");

var _contract = require("./contract/contract");

var _rpcMethod = _interopRequireDefault(require("./rpc-method"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }
  return obj;
}

class Iotx extends _rpcMethod.default {
  constructor(hostname, opts) {
    super(hostname);

    _defineProperty(this, "accounts", void 0);

    _defineProperty(this, "signer", void 0);

    this.accounts = new _accounts.Accounts(this);
    this.signer = opts && opts.signer;
  }

  async tryGetAccount(address) {
    const sender =
      this.signer && this.signer.getAccount
        ? await this.signer.getAccount(address)
        : this.accounts.getAccount(address);

    if (!sender) {
      throw new Error(`cannot find account: ${address}`);
    }

    return sender;
  }

  currentProvider() {
    return this.client;
  }

  async sendTransfer(req) {
    const sender = await this.tryGetAccount(req.from);
    const payload = req.payload || "";
    return new _method.TransferMethod(
      this,
      sender,
      {
        gasLimit: req.gasLimit,
        gasPrice: req.gasPrice,
        amount: req.value,
        recipient: req.to,
        payload: payload
      },
      {
        signer: this.signer
      }
    ).execute();
  } // return action hash

  async deployContract(
    req, // @ts-ignore
    // tslint:disable-next-line: typedef
    ...args
  ) {
    const sender = await this.tryGetAccount(req.from);
    return new _contract.Contract(JSON.parse(req.abi), undefined, {
      data: req.data,
      provider: this,
      signer: this.signer
    }).deploy(sender, args, req.gasLimit, req.gasPrice);
  } // return action hash

  async executeContract(
    req, // @ts-ignore
    // tslint:disable-next-line: typedef
    ...args
  ) {
    const sender = await this.tryGetAccount(req.from);
    const contract = new _contract.Contract(
      JSON.parse(req.abi),
      req.contractAddress,
      {
        provider: this,
        signer: this.signer
      }
    );
    return contract.methods[req.method](...args, {
      account: sender,
      amount: req.amount,
      gasLimit: req.gasLimit,
      gasPrice: req.gasPrice
    });
  }

  async readContractByMethod(req, ...args) {
    const contract = new _contract.Contract(
      JSON.parse(req.abi),
      req.contractAddress,
      {
        provider: this,
        signer: this.signer
      }
    );
    const result = await this.readContract({
      execution: contract.pureEncodeMethod("0", req.method, ...args),
      callerAddress: req.from
    });
    return contract.decodeMethodResult(req.method, result.data);
  }

  async claimFromRewardingFund(req) {
    const sender = await this.tryGetAccount(req.from);
    return new _method.ClaimFromRewardingFundMethod(
      this,
      sender,
      {
        gasLimit: req.gasLimit,
        gasPrice: req.gasPrice,
        amount: req.amount,
        data: req.data
      },
      {
        signer: this.signer
      }
    ).execute();
  }
}

exports.Iotx = Iotx;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pb3R4LnRzIl0sIm5hbWVzIjpbIklvdHgiLCJScGNNZXRob2QiLCJjb25zdHJ1Y3RvciIsImhvc3RuYW1lIiwib3B0cyIsImFjY291bnRzIiwiQWNjb3VudHMiLCJzaWduZXIiLCJ0cnlHZXRBY2NvdW50IiwiYWRkcmVzcyIsInNlbmRlciIsImdldEFjY291bnQiLCJFcnJvciIsImN1cnJlbnRQcm92aWRlciIsImNsaWVudCIsInNlbmRUcmFuc2ZlciIsInJlcSIsImZyb20iLCJwYXlsb2FkIiwiVHJhbnNmZXJNZXRob2QiLCJnYXNMaW1pdCIsImdhc1ByaWNlIiwiYW1vdW50IiwidmFsdWUiLCJyZWNpcGllbnQiLCJ0byIsImV4ZWN1dGUiLCJkZXBsb3lDb250cmFjdCIsImFyZ3MiLCJDb250cmFjdCIsIkpTT04iLCJwYXJzZSIsImFiaSIsInVuZGVmaW5lZCIsImRhdGEiLCJwcm92aWRlciIsImRlcGxveSIsImV4ZWN1dGVDb250cmFjdCIsImNvbnRyYWN0IiwiY29udHJhY3RBZGRyZXNzIiwibWV0aG9kcyIsIm1ldGhvZCIsImFjY291bnQiLCJyZWFkQ29udHJhY3RCeU1ldGhvZCIsInJlc3VsdCIsInJlYWRDb250cmFjdCIsImV4ZWN1dGlvbiIsInB1cmVFbmNvZGVNZXRob2QiLCJjYWxsZXJBZGRyZXNzIiwiZGVjb2RlTWV0aG9kUmVzdWx0IiwiY2xhaW1Gcm9tUmV3YXJkaW5nRnVuZCIsIkNsYWltRnJvbVJld2FyZGluZ0Z1bmRNZXRob2QiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFFQTs7QUFDQTs7QUFLQTs7QUFDQTs7Ozs7O0FBV08sTUFBTUEsSUFBTixTQUFtQkMsa0JBQW5CLENBQTZCO0FBSWxDQyxFQUFBQSxXQUFXLENBQUNDLFFBQUQsRUFBbUJDLElBQW5CLEVBQW9DO0FBQzdDLFVBQU1ELFFBQU47O0FBRDZDOztBQUFBOztBQUU3QyxTQUFLRSxRQUFMLEdBQWdCLElBQUlDLGtCQUFKLENBQWMsSUFBZCxDQUFoQjtBQUNBLFNB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TUFBQUEsSUFBSSxFQUFFbEIsR0FBRyxDQUFDa0I7QUFKWixLQUhLLEVBU0w7QUFBRTNCLE1BQUFBLE1BQU0sRUFBRSxLQUFLQTtBQUFmLEtBVEssRUFVTG1CLE9BVkssRUFBUDtBQVdEOztBQWhIaUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiB0c2xpbnQ6ZGlzYWJsZTpuby1hbnkgKi9cbmltcG9ydCB7IEFjY291bnQgfSBmcm9tIFwiLi9hY2NvdW50L2FjY291bnRcIjtcbmltcG9ydCB7IEFjY291bnRzIH0gZnJvbSBcIi4vYWNjb3VudC9hY2NvdW50c1wiO1xuaW1wb3J0IHtcbiAgQ2xhaW1Gcm9tUmV3YXJkaW5nRnVuZE1ldGhvZCxcbiAgU2lnbmVyUGx1Z2luLFxuICBUcmFuc2Zlck1ldGhvZFxufSBmcm9tIFwiLi9hY3Rpb24vbWV0aG9kXCI7XG5pbXBvcnQgeyBDb250cmFjdCB9IGZyb20gXCIuL2NvbnRyYWN0L2NvbnRyYWN0XCI7XG5pbXBvcnQgUnBjTWV0aG9kIGZyb20gXCIuL3JwYy1tZXRob2RcIjtcbmltcG9ydCB7IElScGNNZXRob2QgfSBmcm9tIFwiLi9ycGMtbWV0aG9kL3R5cGVzXCI7XG5pbXBvcnQge1xuICBDbGFpbUZyb21SZXdhcmRpbmdGdW5kUmVxdXNldCxcbiAgQ29udHJhY3RSZXF1ZXN0LFxuICBFeGVjdXRlQ29udHJhY3RSZXF1ZXN0LFxuICBUcmFuc2ZlclJlcXVlc3Rcbn0gZnJvbSBcIi4vdHlwZXNcIjtcblxudHlwZSBJb3R4T3B0cyA9IHsgc2lnbmVyPzogU2lnbmVyUGx1Z2luIH07XG5cbmV4cG9ydCBjbGFzcyBJb3R4IGV4dGVuZHMgUnBjTWV0aG9kIHtcbiAgcHVibGljIGFjY291bnRzOiBBY2NvdW50cztcbiAgcHVibGljIHNpZ25lcj86IFNpZ25lclBsdWdpbjtcblxuICBjb25zdHJ1Y3Rvcihob3N0bmFtZTogc3RyaW5nLCBvcHRzPzogSW90eE9wdHMpIHtcbiAgICBzdXBlcihob3N0bmFtZSk7XG4gICAgdGhpcy5hY2NvdW50cyA9IG5ldyBBY2NvdW50cygodGhpcyBhcyBhbnkpIGFzIElScGNNZXRob2QpO1xuICAgIHRoaXMuc2lnbmVyID0gb3B0cyAmJiBvcHRzLnNpZ25lcjtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyB0cnlHZXRBY2NvdW50KGFkZHJlc3M6IHN0cmluZyk6IFByb21pc2U8QWNjb3VudD4ge1xuICAgIGNvbnN0IHNlbmRlciA9XG4gICAgICB0aGlzLnNpZ25lciAmJiB0aGlzLnNpZ25lci5nZXRBY2NvdW50XG4gICAgICAgID8gYXdhaXQgdGhpcy5zaWduZXIuZ2V0QWNjb3VudChhZGRyZXNzKVxuICAgICAgICA6IHRoaXMuYWNjb3VudHMuZ2V0QWNjb3VudChhZGRyZXNzKTtcbiAgICBpZiAoIXNlbmRlcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBjYW5ub3QgZmluZCBhY2NvdW50OiAke2FkZHJlc3N9YCk7XG4gICAgfVxuICAgIHJldHVybiBzZW5kZXI7XG4gIH1cblxuICBwdWJsaWMgY3VycmVudFByb3ZpZGVyKCk6IElScGNNZXRob2Qge1xuICAgIHJldHVybiB0aGlzLmNsaWVudDtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBzZW5kVHJhbnNmZXIocmVxOiBUcmFuc2ZlclJlcXVlc3QpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IHNlbmRlciA9IGF3YWl0IHRoaXMudHJ5R2V0QWNjb3VudChyZXEuZnJvbSk7XG4gICAgY29uc3QgcGF5bG9hZCA9IHJlcS5wYXlsb2FkIHx8IFwiXCI7XG4gICAgcmV0dXJuIG5ldyBUcmFuc2Zlck1ldGhvZChcbiAgICAgIHRoaXMsXG4gICAgICBzZW5kZXIsXG4gICAgICB7XG4gICAgICAgIGdhc0xpbWl0OiByZXEuZ2FzTGltaXQsXG4gICAgICAgIGdhc1ByaWNlOiByZXEuZ2FzUHJpY2UsXG4gICAgICAgIGFtb3VudDogcmVxLnZhbHVlLFxuICAgICAgICByZWNpcGllbnQ6IHJlcS50byxcbiAgICAgICAgcGF5bG9hZDogcGF5bG9hZFxuICAgICAgfSxcbiAgICAgIHsgc2lnbmVyOiB0aGlzLnNpZ25lciB9XG4gICAgKS5leGVjdXRlKCk7XG4gIH1cblxuICAvLyByZXR1cm4gYWN0aW9uIGhhc2hcbiAgcHVibGljIGFzeW5jIGRlcGxveUNvbnRyYWN0KFxuICAgIHJlcTogQ29udHJhY3RSZXF1ZXN0LFxuICAgIC8vIEB0cy1pZ25vcmVcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IHR5cGVkZWZcbiAgICAuLi5hcmdzXG4gICk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgY29uc3Qgc2VuZGVyID0gYXdhaXQgdGhpcy50cnlHZXRBY2NvdW50KHJlcS5mcm9tKTtcblxuICAgIHJldHVybiBuZXcgQ29udHJhY3QoSlNPTi5wYXJzZShyZXEuYWJpKSwgdW5kZWZpbmVkLCB7XG4gICAgICBkYXRhOiByZXEuZGF0YSxcbiAgICAgIHByb3ZpZGVyOiB0aGlzLFxuICAgICAgc2lnbmVyOiB0aGlzLnNpZ25lclxuICAgIH0pLmRlcGxveShzZW5kZXIsIGFyZ3MsIHJlcS5nYXNMaW1pdCwgcmVxLmdhc1ByaWNlKTtcbiAgfVxuXG4gIC8vIHJldHVybiBhY3Rpb24gaGFzaFxuICBwdWJsaWMgYXN5bmMgZXhlY3V0ZUNvbnRyYWN0KFxuICAgIHJlcTogRXhlY3V0ZUNvbnRyYWN0UmVxdWVzdCxcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiB0eXBlZGVmXG4gICAgLi4uYXJnc1xuICApOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IHNlbmRlciA9IGF3YWl0IHRoaXMudHJ5R2V0QWNjb3VudChyZXEuZnJvbSk7XG5cbiAgICBjb25zdCBjb250cmFjdCA9IG5ldyBDb250cmFjdChKU09OLnBhcnNlKHJlcS5hYmkpLCByZXEuY29udHJhY3RBZGRyZXNzLCB7XG4gICAgICBwcm92aWRlcjogdGhpcyxcbiAgICAgIHNpZ25lcjogdGhpcy5zaWduZXJcbiAgICB9KTtcbiAgICByZXR1cm4gY29udHJhY3QubWV0aG9kc1tyZXEubWV0aG9kXSguLi5hcmdzLCB7XG4gICAgICBhY2NvdW50OiBzZW5kZXIsXG4gICAgICBhbW91bnQ6IHJlcS5hbW91bnQsXG4gICAgICBnYXNMaW1pdDogcmVxLmdhc0xpbWl0LFxuICAgICAgZ2FzUHJpY2U6IHJlcS5nYXNQcmljZVxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIHJlYWRDb250cmFjdEJ5TWV0aG9kKFxuICAgIHJlcTogRXhlY3V0ZUNvbnRyYWN0UmVxdWVzdCxcbiAgICAuLi5hcmdzOiBBcnJheTxhbnk+XG4gICk6IFByb21pc2U8YW55IHwgQXJyYXk8YW55Pj4ge1xuICAgIGNvbnN0IGNvbnRyYWN0ID0gbmV3IENvbnRyYWN0KEpTT04ucGFyc2UocmVxLmFiaSksIHJlcS5jb250cmFjdEFkZHJlc3MsIHtcbiAgICAgIHByb3ZpZGVyOiB0aGlzLFxuICAgICAgc2lnbmVyOiB0aGlzLnNpZ25lclxuICAgIH0pO1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5yZWFkQ29udHJhY3Qoe1xuICAgICAgZXhlY3V0aW9uOiBjb250cmFjdC5wdXJlRW5jb2RlTWV0aG9kKFwiMFwiLCByZXEubWV0aG9kLCAuLi5hcmdzKSxcbiAgICAgIGNhbGxlckFkZHJlc3M6IHJlcS5mcm9tXG4gICAgfSk7XG5cbiAgICByZXR1cm4gY29udHJhY3QuZGVjb2RlTWV0aG9kUmVzdWx0KHJlcS5tZXRob2QsIHJlc3VsdC5kYXRhKTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBjbGFpbUZyb21SZXdhcmRpbmdGdW5kKFxuICAgIHJlcTogQ2xhaW1Gcm9tUmV3YXJkaW5nRnVuZFJlcXVzZXRcbiAgKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBzZW5kZXIgPSBhd2FpdCB0aGlzLnRyeUdldEFjY291bnQocmVxLmZyb20pO1xuXG4gICAgcmV0dXJuIG5ldyBDbGFpbUZyb21SZXdhcmRpbmdGdW5kTWV0aG9kKFxuICAgICAgdGhpcyxcbiAgICAgIHNlbmRlcixcbiAgICAgIHtcbiAgICAgICAgZ2FzTGltaXQ6IHJlcS5nYXNMaW1pdCxcbiAgICAgICAgZ2FzUHJpY2U6IHJlcS5nYXNQcmljZSxcbiAgICAgICAgYW1vdW50OiByZXEuYW1vdW50LFxuICAgICAgICBkYXRhOiByZXEuZGF0YVxuICAgICAgfSxcbiAgICAgIHsgc2lnbmVyOiB0aGlzLnNpZ25lciB9XG4gICAgKS5leGVjdXRlKCk7XG4gIH1cbn1cbiJdfQ==
