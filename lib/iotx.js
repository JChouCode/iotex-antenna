"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Iotx = void 0;

var _accounts = require("./account/accounts");

var _utils = require("./account/utils");

var _method = require("./action/method");

var _contract = require("./contract/contract");

var _rpcMethod = _interopRequireDefault(require("./rpc-method"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }
  return obj;
}

class Iotx extends _rpcMethod.default {
  constructor(hostname) {
    super(hostname);

    _defineProperty(this, "accounts", void 0);

    this.accounts = new _accounts.Accounts(this);
  }

  currentProvider() {
    return this.client;
  }

  sendTransfer(req) {
    const sender = this.accounts.getAccount(req.from);

    if (!sender) {
      throw new Error(`can not found account: ${req.from}`);
    }

    const price = req.gasPrice
      ? (0, _utils.toRau)(String(req.gasPrice), "Qev")
      : undefined;
    const payload = req.payload || "";
    return new _method.TransferMethod(this, sender, {
      gasLimit: req.gasLimit,
      gasPrice: price,
      amount: req.value,
      recipient: req.to,
      payload: payload
    }).execute();
  } // return action hash

  deployContract(
    req, // @ts-ignore
    ...args
  ) {
    const sender = this.accounts.getAccount(req.from);

    if (!sender) {
      throw new Error(`can not found account: ${req.from}`);
    }

    const price = req.gasPrice
      ? (0, _utils.toRau)(String(req.gasPrice), "Qev")
      : undefined;
    return new _contract.Contract(JSON.parse(req.abi), undefined, {
      data: req.data,
      provider: this
    }).deploy(sender, args, req.gasLimit, price);
  } // return action hash

  executeContract(
    req, // @ts-ignore
    ...args
  ) {
    const sender = this.accounts.getAccount(req.from);

    if (!sender) {
      throw new Error(`can not found account: ${req.from}`);
    }

    const price = req.gasPrice
      ? (0, _utils.toRau)(String(req.gasPrice), "Qev")
      : undefined;
    const contract = new _contract.Contract(
      JSON.parse(req.abi),
      req.contractAddress,
      {
        provider: this
      }
    );
    return contract.methods[req.method](...args, {
      account: sender,
      amount: req.amount,
      gasLimit: req.gasLimit,
      gasPrice: price
    });
  }

  async readContractByMethod(
    req, // @ts-ignore
    ...args
  ) {
    const contract = new _contract.Contract(
      JSON.parse(req.abi),
      req.contractAddress,
      {
        provider: this
      }
    );
    const result = await this.readContract({
      execution: contract.pureEncodeMethod("0", req.method, ...args),
      callerAddress: req.from
    });
    return result.data;
  }

  async claimFromRewardingFund(req) {
    const sender = this.accounts.getAccount(req.from);

    if (!sender) {
      throw new Error(`can not found account: ${req.from}`);
    }

    const price = req.gasPrice
      ? (0, _utils.toRau)(String(req.gasPrice), "Qev")
      : undefined;
    return new _method.ClaimFromRewardingFundMethod(this, sender, {
      gasLimit: req.gasLimit,
      gasPrice: price,
      amount: req.amount,
      data: req.data
    }).execute();
  }
}

exports.Iotx = Iotx;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pb3R4LnRzIl0sIm5hbWVzIjpbIklvdHgiLCJScGNNZXRob2QiLCJjb25zdHJ1Y3RvciIsImhvc3RuYW1lIiwiYWNjb3VudHMiLCJBY2NvdW50cyIsImN1cnJlbnRQcm92aWRlciIsImNsaWVudCIsInNlbmRUcmFuc2ZlciIsInJlcSIsInNlbmRlciIsImdldEFjY291bnQiLCJmcm9tIiwiRXJyb3IiLCJwcmljZSIsImdhc1ByaWNlIiwiU3RyaW5nIiwidW5kZWZpbmVkIiwicGF5bG9hZCIsIlRyYW5zZmVyTWV0aG9kIiwiZ2FzTGltaXQiLCJhbW91bnQiLCJ2YWx1ZSIsInJlY2lwaWVudCIsInRvIiwiZXhlY3V0ZSIsImRlcGxveUNvbnRyYWN0IiwiYXJncyIsIkNvbnRyYWN0IiwiSlNPTiIsInBhcnNlIiwiYWJpIiwiZGF0YSIsInByb3ZpZGVyIiwiZGVwbG95IiwiZXhlY3V0ZUNvbnRyYWN0IiwiY29udHJhY3QiLCJjb250cmFjdEFkZHJlc3MiLCJtZXRob2RzIiwibWV0aG9kIiwiYWNjb3VudCIsInJlYWRDb250cmFjdEJ5TWV0aG9kIiwicmVzdWx0IiwicmVhZENvbnRyYWN0IiwiZXhlY3V0aW9uIiwicHVyZUVuY29kZU1ldGhvZCIsImNhbGxlckFkZHJlc3MiLCJjbGFpbUZyb21SZXdhcmRpbmdGdW5kIiwiQ2xhaW1Gcm9tUmV3YXJkaW5nRnVuZE1ldGhvZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7QUFTTyxNQUFNQSxJQUFOLFNBQW1CQyxrQkFBbkIsQ0FBNkI7QUFFbENDLEVBQUFBLFdBQVcsQ0FBQ0MsUUFBRCxFQUFtQjtBQUM1QixVQUFNQSxRQUFOOztBQUQ0Qjs7QUFFNUIsU0FBS0MsUUFBTCxHQUFnQixJQUFJQyxrQkFBSixDQUFhLElBQWIsQ0FBaEI7QUFDRDs7QUFFTUMsRUFBQUEsZUFBUCxHQUFxQztBQUNuQyxXQUFPLEtBQUtDLE1BQVo7QUFDRDs7QUFFTUMsRUFBQUEsWUFBUCxDQUFvQkMsR0FBcEIsRUFBMkQ7QUFDekQsVUFBTUMsTUFBTSxHQUFHLEtBQUtOLFFBQUwsQ0FBY08sVUFBZCxDQUF5QkYsR0FBRyxDQUFDRyxJQUE3QixDQUFmOztBQUNBLFFBQUksQ0FBQ0YsTUFBTCxFQUFhO0FBQ1gsWUFBTSxJQUFJRyxLQUFKLENBQVcsMEJBQXlCSixHQUFHLENBQUNHLElBQUssRUFBN0MsQ0FBTjtBQUNEOztBQUVELFVBQU1FLEtBQUssR0FBR0wsR0FBRyxDQUFDTSxRQUFKLEdBQWUsa0JBQU1DLE1BQU0sQ0FBQ1AsR0FBRyxDQUFDTSxRQUFMLENBQVosRUFBNEIsS0FBNUIsQ0FBZixHQUFvREUsU0FBbEU7QUFDQSxVQUFNQyxPQUFPLEdBQUdULEdBQUcsQ0FBQ1MsT0FBSixJQUFlLEVBQS9CO0FBQ0EsV0FBTyxJQUFJQyxzQkFBSixDQUFtQixJQUFuQixFQUF5QlQsTUFBekIsRUFBaUM7QUFDdENVLE1BQUFBLFFBQVEsRUFBRVgsR0FBRyxDQUFDVyxRQUR3QjtBQUV0Q0wsTUFBQUEsUUFBUSxFQUFFRCxLQUY0QjtBQUd0Q08sTUFBQUEsTUFBTSxFQUFFWixHQUFHLENBQUNhLEtBSDBCO0FBSXRDQyxNQUFBQSxTQUFTLEVBQUVkLEdBQUcsQ0FBQ2UsRUFKdUI7QUFLdENOLE1BQUFBLE9BQU8sRUFBRUE7QUFMNkIsS0FBakMsRUFNSk8sT0FOSSxFQUFQO0FBT0QsR0ExQmlDLENBNEJsQzs7O0FBQ09DLEVBQUFBLGNBQVAsQ0FDRWpCLEdBREYsRUFFRTtBQUVBLEtBQUdrQixJQUpMLEVBS21CO0FBQ2pCLFVBQU1qQixNQUFNLEdBQUcsS0FBS04sUUFBTCxDQUFjTyxVQUFkLENBQXlCRixHQUFHLENBQUNHLElBQTdCLENBQWY7O0FBQ0EsUUFBSSxDQUFDRixNQUFMLEVBQWE7QUFDWCxZQUFNLElBQUlHLEtBQUosQ0FBVywwQkFBeUJKLEdBQUcsQ0FBQ0csSUFBSyxFQUE3QyxDQUFOO0FBQ0Q7O0FBRUQsVUFBTUUsS0FBSyxHQUFHTCxHQUFHLENBQUNNLFFBQUosR0FBZSxrQkFBTUMsTUFBTSxDQUFDUCxHQUFHLENBQUNNLFFBQUwsQ0FBWixFQUE0QixLQUE1QixDQUFmLEdBQW9ERSxTQUFsRTtBQUNBLFdBQU8sSUFBSVcsa0JBQUosQ0FBYUMsSUFBSSxDQUFDQyxLQUFMLENBQVdyQixHQUFHLENBQUNzQixHQUFmLENBQWIsRUFBa0NkLFNBQWxDLEVBQTZDO0FBQ2xEZSxNQUFBQSxJQUFJLEVBQUV2QixHQUFHLENBQUN1QixJQUR3QztBQUVsREMsTUFBQUEsUUFBUSxFQUFFO0FBRndDLEtBQTdDLEVBR0pDLE1BSEksQ0FHR3hCLE1BSEgsRUFHV2lCLElBSFgsRUFHaUJsQixHQUFHLENBQUNXLFFBSHJCLEVBRytCTixLQUgvQixDQUFQO0FBSUQsR0E3Q2lDLENBK0NsQzs7O0FBQ09xQixFQUFBQSxlQUFQLENBQ0UxQixHQURGLEVBRUU7QUFFQSxLQUFHa0IsSUFKTCxFQUttQjtBQUNqQixVQUFNakIsTUFBTSxHQUFHLEtBQUtOLFFBQUwsQ0FBY08sVUFBZCxDQUF5QkYsR0FBRyxDQUFDRyxJQUE3QixDQUFmOztBQUNBLFFBQUksQ0FBQ0YsTUFBTCxFQUFhO0FBQ1gsWUFBTSxJQUFJRyxLQUFKLENBQVcsMEJBQXlCSixHQUFHLENBQUNHLElBQUssRUFBN0MsQ0FBTjtBQUNEOztBQUVELFVBQU1FLEtBQUssR0FBR0wsR0FBRyxDQUFDTSxRQUFKLEdBQWUsa0JBQU1DLE1BQU0sQ0FBQ1AsR0FBRyxDQUFDTSxRQUFMLENBQVosRUFBNEIsS0FBNUIsQ0FBZixHQUFvREUsU0FBbEU7QUFDQSxVQUFNbUIsUUFBUSxHQUFHLElBQUlSLGtCQUFKLENBQWFDLElBQUksQ0FBQ0MsS0FBTCxDQUFXckIsR0FBRyxDQUFDc0IsR0FBZixDQUFiLEVBQWtDdEIsR0FBRyxDQUFDNEIsZUFBdEMsRUFBdUQ7QUFDdEVKLE1BQUFBLFFBQVEsRUFBRTtBQUQ0RCxLQUF2RCxDQUFqQjtBQUdBLFdBQU9HLFFBQVEsQ0FBQ0UsT0FBVCxDQUFpQjdCLEdBQUcsQ0FBQzhCLE1BQXJCLEVBQTZCLEdBQUdaLElBQWhDLEVBQXNDO0FBQzNDYSxNQUFBQSxPQUFPLEVBQUU5QixNQURrQztBQUUzQ1csTUFBQUEsTUFBTSxFQUFFWixHQUFHLENBQUNZLE1BRitCO0FBRzNDRCxNQUFBQSxRQUFRLEVBQUVYLEdBQUcsQ0FBQ1csUUFINkI7QUFJM0NMLE1BQUFBLFFBQVEsRUFBRUQ7QUFKaUMsS0FBdEMsQ0FBUDtBQU1EOztBQUVELFFBQWEyQixvQkFBYixDQUNFaEMsR0FERixFQUVFO0FBRUEsS0FBR2tCLElBSkwsRUFLbUI7QUFDakIsVUFBTVMsUUFBUSxHQUFHLElBQUlSLGtCQUFKLENBQWFDLElBQUksQ0FBQ0MsS0FBTCxDQUFXckIsR0FBRyxDQUFDc0IsR0FBZixDQUFiLEVBQWtDdEIsR0FBRyxDQUFDNEIsZUFBdEMsRUFBdUQ7QUFDdEVKLE1BQUFBLFFBQVEsRUFBRTtBQUQ0RCxLQUF2RCxDQUFqQjtBQUlBLFVBQU1TLE1BQU0sR0FBRyxNQUFNLEtBQUtDLFlBQUwsQ0FBa0I7QUFDckNDLE1BQUFBLFNBQVMsRUFBRVIsUUFBUSxDQUFDUyxnQkFBVCxDQUEwQixHQUExQixFQUErQnBDLEdBQUcsQ0FBQzhCLE1BQW5DLEVBQTJDLEdBQUdaLElBQTlDLENBRDBCO0FBRXJDbUIsTUFBQUEsYUFBYSxFQUFFckMsR0FBRyxDQUFDRztBQUZrQixLQUFsQixDQUFyQjtBQUtBLFdBQU84QixNQUFNLENBQUNWLElBQWQ7QUFDRDs7QUFFRCxRQUFhZSxzQkFBYixDQUNFdEMsR0FERixFQUVtQjtBQUNqQixVQUFNQyxNQUFNLEdBQUcsS0FBS04sUUFBTCxDQUFjTyxVQUFkLENBQXlCRixHQUFHLENBQUNHLElBQTdCLENBQWY7O0FBQ0EsUUFBSSxDQUFDRixNQUFMLEVBQWE7QUFDWCxZQUFNLElBQUlHLEtBQUosQ0FBVywwQkFBeUJKLEdBQUcsQ0FBQ0csSUFBSyxFQUE3QyxDQUFOO0FBQ0Q7O0FBRUQsVUFBTUUsS0FBSyxHQUFHTCxHQUFHLENBQUNNLFFBQUosR0FBZSxrQkFBTUMsTUFBTSxDQUFDUCxHQUFHLENBQUNNLFFBQUwsQ0FBWixFQUE0QixLQUE1QixDQUFmLEdBQW9ERSxTQUFsRTtBQUNBLFdBQU8sSUFBSStCLG9DQUFKLENBQWlDLElBQWpDLEVBQXVDdEMsTUFBdkMsRUFBK0M7QUFDcERVLE1BQUFBLFFBQVEsRUFBRVgsR0FBRyxDQUFDVyxRQURzQztBQUVwREwsTUFBQUEsUUFBUSxFQUFFRCxLQUYwQztBQUdwRE8sTUFBQUEsTUFBTSxFQUFFWixHQUFHLENBQUNZLE1BSHdDO0FBSXBEVyxNQUFBQSxJQUFJLEVBQUV2QixHQUFHLENBQUN1QjtBQUowQyxLQUEvQyxFQUtKUCxPQUxJLEVBQVA7QUFNRDs7QUF4R2lDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWNjb3VudHMgfSBmcm9tIFwiLi9hY2NvdW50L2FjY291bnRzXCI7XG5pbXBvcnQgeyB0b1JhdSB9IGZyb20gXCIuL2FjY291bnQvdXRpbHNcIjtcbmltcG9ydCB7IENsYWltRnJvbVJld2FyZGluZ0Z1bmRNZXRob2QsIFRyYW5zZmVyTWV0aG9kIH0gZnJvbSBcIi4vYWN0aW9uL21ldGhvZFwiO1xuaW1wb3J0IHsgQ29udHJhY3QgfSBmcm9tIFwiLi9jb250cmFjdC9jb250cmFjdFwiO1xuaW1wb3J0IFJwY01ldGhvZCBmcm9tIFwiLi9ycGMtbWV0aG9kXCI7XG5pbXBvcnQgeyBJUnBjTWV0aG9kIH0gZnJvbSBcIi4vcnBjLW1ldGhvZC90eXBlc1wiO1xuaW1wb3J0IHtcbiAgQ2xhaW1Gcm9tUmV3YXJkaW5nRnVuZFJlcXVzZXQsXG4gIENvbnRyYWN0UmVxdWVzdCxcbiAgRXhlY3V0ZUNvbnRyYWN0UmVxdWVzdCxcbiAgVHJhbnNmZXJSZXF1ZXN0XG59IGZyb20gXCIuL3R5cGVzXCI7XG5cbmV4cG9ydCBjbGFzcyBJb3R4IGV4dGVuZHMgUnBjTWV0aG9kIHtcbiAgcHVibGljIGFjY291bnRzOiBBY2NvdW50cztcbiAgY29uc3RydWN0b3IoaG9zdG5hbWU6IHN0cmluZykge1xuICAgIHN1cGVyKGhvc3RuYW1lKTtcbiAgICB0aGlzLmFjY291bnRzID0gbmV3IEFjY291bnRzKHRoaXMpO1xuICB9XG5cbiAgcHVibGljIGN1cnJlbnRQcm92aWRlcigpOiBJUnBjTWV0aG9kIHtcbiAgICByZXR1cm4gdGhpcy5jbGllbnQ7XG4gIH1cblxuICBwdWJsaWMgc2VuZFRyYW5zZmVyKHJlcTogVHJhbnNmZXJSZXF1ZXN0KTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBzZW5kZXIgPSB0aGlzLmFjY291bnRzLmdldEFjY291bnQocmVxLmZyb20pO1xuICAgIGlmICghc2VuZGVyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYGNhbiBub3QgZm91bmQgYWNjb3VudDogJHtyZXEuZnJvbX1gKTtcbiAgICB9XG5cbiAgICBjb25zdCBwcmljZSA9IHJlcS5nYXNQcmljZSA/IHRvUmF1KFN0cmluZyhyZXEuZ2FzUHJpY2UpLCBcIlFldlwiKSA6IHVuZGVmaW5lZDtcbiAgICBjb25zdCBwYXlsb2FkID0gcmVxLnBheWxvYWQgfHwgXCJcIjtcbiAgICByZXR1cm4gbmV3IFRyYW5zZmVyTWV0aG9kKHRoaXMsIHNlbmRlciwge1xuICAgICAgZ2FzTGltaXQ6IHJlcS5nYXNMaW1pdCxcbiAgICAgIGdhc1ByaWNlOiBwcmljZSxcbiAgICAgIGFtb3VudDogcmVxLnZhbHVlLFxuICAgICAgcmVjaXBpZW50OiByZXEudG8sXG4gICAgICBwYXlsb2FkOiBwYXlsb2FkXG4gICAgfSkuZXhlY3V0ZSgpO1xuICB9XG5cbiAgLy8gcmV0dXJuIGFjdGlvbiBoYXNoXG4gIHB1YmxpYyBkZXBsb3lDb250cmFjdChcbiAgICByZXE6IENvbnRyYWN0UmVxdWVzdCxcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiB0eXBlZGVmXG4gICAgLi4uYXJnc1xuICApOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IHNlbmRlciA9IHRoaXMuYWNjb3VudHMuZ2V0QWNjb3VudChyZXEuZnJvbSk7XG4gICAgaWYgKCFzZW5kZXIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgY2FuIG5vdCBmb3VuZCBhY2NvdW50OiAke3JlcS5mcm9tfWApO1xuICAgIH1cblxuICAgIGNvbnN0IHByaWNlID0gcmVxLmdhc1ByaWNlID8gdG9SYXUoU3RyaW5nKHJlcS5nYXNQcmljZSksIFwiUWV2XCIpIDogdW5kZWZpbmVkO1xuICAgIHJldHVybiBuZXcgQ29udHJhY3QoSlNPTi5wYXJzZShyZXEuYWJpKSwgdW5kZWZpbmVkLCB7XG4gICAgICBkYXRhOiByZXEuZGF0YSxcbiAgICAgIHByb3ZpZGVyOiB0aGlzXG4gICAgfSkuZGVwbG95KHNlbmRlciwgYXJncywgcmVxLmdhc0xpbWl0LCBwcmljZSk7XG4gIH1cblxuICAvLyByZXR1cm4gYWN0aW9uIGhhc2hcbiAgcHVibGljIGV4ZWN1dGVDb250cmFjdChcbiAgICByZXE6IEV4ZWN1dGVDb250cmFjdFJlcXVlc3QsXG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogdHlwZWRlZlxuICAgIC4uLmFyZ3NcbiAgKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBzZW5kZXIgPSB0aGlzLmFjY291bnRzLmdldEFjY291bnQocmVxLmZyb20pO1xuICAgIGlmICghc2VuZGVyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYGNhbiBub3QgZm91bmQgYWNjb3VudDogJHtyZXEuZnJvbX1gKTtcbiAgICB9XG5cbiAgICBjb25zdCBwcmljZSA9IHJlcS5nYXNQcmljZSA/IHRvUmF1KFN0cmluZyhyZXEuZ2FzUHJpY2UpLCBcIlFldlwiKSA6IHVuZGVmaW5lZDtcbiAgICBjb25zdCBjb250cmFjdCA9IG5ldyBDb250cmFjdChKU09OLnBhcnNlKHJlcS5hYmkpLCByZXEuY29udHJhY3RBZGRyZXNzLCB7XG4gICAgICBwcm92aWRlcjogdGhpc1xuICAgIH0pO1xuICAgIHJldHVybiBjb250cmFjdC5tZXRob2RzW3JlcS5tZXRob2RdKC4uLmFyZ3MsIHtcbiAgICAgIGFjY291bnQ6IHNlbmRlcixcbiAgICAgIGFtb3VudDogcmVxLmFtb3VudCxcbiAgICAgIGdhc0xpbWl0OiByZXEuZ2FzTGltaXQsXG4gICAgICBnYXNQcmljZTogcHJpY2VcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyByZWFkQ29udHJhY3RCeU1ldGhvZChcbiAgICByZXE6IEV4ZWN1dGVDb250cmFjdFJlcXVlc3QsXG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogdHlwZWRlZlxuICAgIC4uLmFyZ3NcbiAgKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBjb250cmFjdCA9IG5ldyBDb250cmFjdChKU09OLnBhcnNlKHJlcS5hYmkpLCByZXEuY29udHJhY3RBZGRyZXNzLCB7XG4gICAgICBwcm92aWRlcjogdGhpc1xuICAgIH0pO1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5yZWFkQ29udHJhY3Qoe1xuICAgICAgZXhlY3V0aW9uOiBjb250cmFjdC5wdXJlRW5jb2RlTWV0aG9kKFwiMFwiLCByZXEubWV0aG9kLCAuLi5hcmdzKSxcbiAgICAgIGNhbGxlckFkZHJlc3M6IHJlcS5mcm9tXG4gICAgfSk7XG5cbiAgICByZXR1cm4gcmVzdWx0LmRhdGE7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgY2xhaW1Gcm9tUmV3YXJkaW5nRnVuZChcbiAgICByZXE6IENsYWltRnJvbVJld2FyZGluZ0Z1bmRSZXF1c2V0XG4gICk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgY29uc3Qgc2VuZGVyID0gdGhpcy5hY2NvdW50cy5nZXRBY2NvdW50KHJlcS5mcm9tKTtcbiAgICBpZiAoIXNlbmRlcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBjYW4gbm90IGZvdW5kIGFjY291bnQ6ICR7cmVxLmZyb219YCk7XG4gICAgfVxuXG4gICAgY29uc3QgcHJpY2UgPSByZXEuZ2FzUHJpY2UgPyB0b1JhdShTdHJpbmcocmVxLmdhc1ByaWNlKSwgXCJRZXZcIikgOiB1bmRlZmluZWQ7XG4gICAgcmV0dXJuIG5ldyBDbGFpbUZyb21SZXdhcmRpbmdGdW5kTWV0aG9kKHRoaXMsIHNlbmRlciwge1xuICAgICAgZ2FzTGltaXQ6IHJlcS5nYXNMaW1pdCxcbiAgICAgIGdhc1ByaWNlOiBwcmljZSxcbiAgICAgIGFtb3VudDogcmVxLmFtb3VudCxcbiAgICAgIGRhdGE6IHJlcS5kYXRhXG4gICAgfSkuZXhlY3V0ZSgpO1xuICB9XG59XG4iXX0=
