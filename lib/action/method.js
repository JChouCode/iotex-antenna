"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ClaimFromRewardingFundMethod = exports.ExecutionMethod = exports.TransferMethod = exports.AbstractMethod = void 0;

var _envelop = require("./envelop");

function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }
  return obj;
}

class AbstractMethod {
  constructor(client, account) {
    _defineProperty(this, "client", void 0);

    _defineProperty(this, "account", void 0);

    this.client = client;
    this.account = account;
  }

  async baseEnvelop(gasLimit, gasPrice) {
    const meta = await this.client.getAccount({
      address: this.account.address
    });
    return new _envelop.Envelop(
      1, // @ts-ignore
      String(meta.accountMeta.pendingNonce),
      gasLimit,
      gasPrice
    );
  }

  async signAction(envelop) {
    if (!envelop.gasPrice) {
      const price = await this.client.suggestGasPrice({});
      envelop.gasPrice = String(price.gasPrice);
    }

    if (!envelop.gasLimit) {
      const selp = await _envelop.SealedEnvelop.sign(this.account, envelop);
      const limit = await this.client.estimateGasForAction({
        action: selp.action()
      });
      envelop.gasLimit = limit.gas;
    }

    return _envelop.SealedEnvelop.sign(this.account, envelop);
  }

  async sendAction(envelop) {
    const selp = await this.signAction(envelop);
    await this.client.sendAction({
      action: selp.action()
    });
    return selp.hash();
  }
}

exports.AbstractMethod = AbstractMethod;

class TransferMethod extends AbstractMethod {
  constructor(client, account, transfer) {
    super(client, account);

    _defineProperty(this, "transfer", void 0);

    this.transfer = transfer;
  }

  async execute() {
    const envelop = await this.baseEnvelop(
      this.transfer.gasLimit,
      this.transfer.gasPrice
    );
    envelop.transfer = {
      amount: this.transfer.amount,
      recipient: this.transfer.recipient,
      payload: Buffer.from(this.transfer.payload, "hex")
    };
    return this.sendAction(envelop);
  }
}

exports.TransferMethod = TransferMethod;

class ExecutionMethod extends AbstractMethod {
  constructor(client, account, execution) {
    super(client, account);

    _defineProperty(this, "execution", void 0);

    this.execution = execution;
  }

  async execute() {
    const envelop = await this.baseEnvelop(
      this.execution.gasLimit,
      this.execution.gasPrice
    );
    envelop.execution = {
      amount: this.execution.amount,
      contract: this.execution.contract,
      data: this.execution.data
    };
    return this.sendAction(envelop);
  }

  async sign() {
    const envelop = await this.baseEnvelop(
      this.execution.gasLimit,
      this.execution.gasPrice
    );
    envelop.execution = {
      amount: this.execution.amount,
      contract: this.execution.contract,
      data: this.execution.data
    };
    const selp = await this.signAction(envelop);
    return selp.action();
  }
}

exports.ExecutionMethod = ExecutionMethod;

class ClaimFromRewardingFundMethod extends AbstractMethod {
  constructor(client, account, claim) {
    super(client, account);

    _defineProperty(this, "claimFronRewardFund", void 0);

    this.claimFronRewardFund = claim;
  }

  async execute() {
    const envelop = await this.baseEnvelop(
      this.claimFronRewardFund.gasLimit,
      this.claimFronRewardFund.gasPrice
    );
    envelop.claimFromRewardingFund = {
      amount: this.claimFronRewardFund.amount,
      data: this.claimFronRewardFund.data
    };
    return this.sendAction(envelop);
  }

  async sign() {
    const envelop = await this.baseEnvelop(
      this.claimFronRewardFund.gasLimit,
      this.claimFronRewardFund.gasPrice
    );
    envelop.claimFromRewardingFund = {
      amount: this.claimFronRewardFund.amount,
      data: this.claimFronRewardFund.data
    };
    const selp = await this.signAction(envelop);
    return selp.action();
  }
}

exports.ClaimFromRewardingFundMethod = ClaimFromRewardingFundMethod;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hY3Rpb24vbWV0aG9kLnRzIl0sIm5hbWVzIjpbIkFic3RyYWN0TWV0aG9kIiwiY29uc3RydWN0b3IiLCJjbGllbnQiLCJhY2NvdW50IiwiYmFzZUVudmVsb3AiLCJnYXNMaW1pdCIsImdhc1ByaWNlIiwibWV0YSIsImdldEFjY291bnQiLCJhZGRyZXNzIiwiRW52ZWxvcCIsIlN0cmluZyIsImFjY291bnRNZXRhIiwicGVuZGluZ05vbmNlIiwic2lnbkFjdGlvbiIsImVudmVsb3AiLCJwcmljZSIsInN1Z2dlc3RHYXNQcmljZSIsInNlbHAiLCJTZWFsZWRFbnZlbG9wIiwic2lnbiIsImxpbWl0IiwiZXN0aW1hdGVHYXNGb3JBY3Rpb24iLCJhY3Rpb24iLCJnYXMiLCJzZW5kQWN0aW9uIiwiaGFzaCIsIlRyYW5zZmVyTWV0aG9kIiwidHJhbnNmZXIiLCJleGVjdXRlIiwiYW1vdW50IiwicmVjaXBpZW50IiwicGF5bG9hZCIsIkJ1ZmZlciIsImZyb20iLCJFeGVjdXRpb25NZXRob2QiLCJleGVjdXRpb24iLCJjb250cmFjdCIsImRhdGEiLCJDbGFpbUZyb21SZXdhcmRpbmdGdW5kTWV0aG9kIiwiY2xhaW0iLCJjbGFpbUZyb25SZXdhcmRGdW5kIiwiY2xhaW1Gcm9tUmV3YXJkaW5nRnVuZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUVBOzs7O0FBR08sTUFBTUEsY0FBTixDQUFxQjtBQUkxQkMsRUFBQUEsV0FBVyxDQUFDQyxNQUFELEVBQXFCQyxPQUFyQixFQUF1QztBQUFBOztBQUFBOztBQUNoRCxTQUFLRCxNQUFMLEdBQWNBLE1BQWQ7QUFDQSxTQUFLQyxPQUFMLEdBQWVBLE9BQWY7QUFDRDs7QUFFRCxRQUFhQyxXQUFiLENBQ0VDLFFBREYsRUFFRUMsUUFGRixFQUdvQjtBQUNsQixVQUFNQyxJQUFJLEdBQUcsTUFBTSxLQUFLTCxNQUFMLENBQVlNLFVBQVosQ0FBdUI7QUFDeENDLE1BQUFBLE9BQU8sRUFBRSxLQUFLTixPQUFMLENBQWFN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Q0FBeUJwQyxRQURMLEVBRXBCLEtBQUtvQyxtQkFBTCxDQUF5Qm5DLFFBRkwsQ0FBdEI7QUFJQVMsSUFBQUEsT0FBTyxDQUFDMkIsc0JBQVIsR0FBaUM7QUFDL0JaLE1BQUFBLE1BQU0sRUFBRSxLQUFLVyxtQkFBTCxDQUF5QlgsTUFERjtBQUUvQlEsTUFBQUEsSUFBSSxFQUFFLEtBQUtHLG1CQUFMLENBQXlCSDtBQUZBLEtBQWpDO0FBS0EsV0FBTyxLQUFLYixVQUFMLENBQWdCVixPQUFoQixDQUFQO0FBQ0Q7O0FBRUQsUUFBYUssSUFBYixHQUFzQztBQUNwQyxVQUFNTCxPQUFPLEdBQUcsTUFBTSxLQUFLWCxXQUFMLENBQ3BCLEtBQUtxQyxtQkFBTCxDQUF5QnBDLFFBREwsRUFFcEIsS0FBS29DLG1CQUFMLENBQXlCbkMsUUFGTCxDQUF0QjtBQUlBUyxJQUFBQSxPQUFPLENBQUMyQixzQkFBUixHQUFpQztBQUMvQlosTUFBQUEsTUFBTSxFQUFFLEtBQUtXLG1CQUFMLENBQXlCWCxNQURGO0FBRS9CUSxNQUFBQSxJQUFJLEVBQUUsS0FBS0csbUJBQUwsQ0FBeUJIO0FBRkEsS0FBakM7QUFLQSxVQUFNcEIsSUFBSSxHQUFHLE1BQU0sS0FBS0osVUFBTCxDQUFnQkMsT0FBaEIsQ0FBbkI7QUFDQSxXQUFPRyxJQUFJLENBQUNLLE1BQUwsRUFBUDtBQUNEOztBQXJDOEQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBY2NvdW50IH0gZnJvbSBcIi4uL2FjY291bnQvYWNjb3VudFwiO1xuaW1wb3J0IHsgSUFjdGlvbiwgSVJwY01ldGhvZCB9IGZyb20gXCIuLi9ycGMtbWV0aG9kL3R5cGVzXCI7XG5pbXBvcnQgeyBFbnZlbG9wLCBTZWFsZWRFbnZlbG9wIH0gZnJvbSBcIi4vZW52ZWxvcFwiO1xuaW1wb3J0IHsgQ2xhaW1Gcm9tUmV3YXJkaW5nRnVuZCwgRXhlY3V0aW9uLCBUcmFuc2ZlciB9IGZyb20gXCIuL3R5cGVzXCI7XG5cbmV4cG9ydCBjbGFzcyBBYnN0cmFjdE1ldGhvZCB7XG4gIHB1YmxpYyBjbGllbnQ6IElScGNNZXRob2Q7XG4gIHB1YmxpYyBhY2NvdW50OiBBY2NvdW50O1xuXG4gIGNvbnN0cnVjdG9yKGNsaWVudDogSVJwY01ldGhvZCwgYWNjb3VudDogQWNjb3VudCkge1xuICAgIHRoaXMuY2xpZW50ID0gY2xpZW50O1xuICAgIHRoaXMuYWNjb3VudCA9IGFjY291bnQ7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgYmFzZUVudmVsb3AoXG4gICAgZ2FzTGltaXQ/OiBzdHJpbmcsXG4gICAgZ2FzUHJpY2U/OiBzdHJpbmdcbiAgKTogUHJvbWlzZTxFbnZlbG9wPiB7XG4gICAgY29uc3QgbWV0YSA9IGF3YWl0IHRoaXMuY2xpZW50LmdldEFjY291bnQoe1xuICAgICAgYWRkcmVzczogdGhpcy5hY2NvdW50LmFkZHJlc3NcbiAgICB9KTtcblxuICAgIHJldHVybiBuZXcgRW52ZWxvcChcbiAgICAgIDEsXG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICBTdHJpbmcobWV0YS5hY2NvdW50TWV0YS5wZW5kaW5nTm9uY2UpLFxuICAgICAgZ2FzTGltaXQsXG4gICAgICBnYXNQcmljZVxuICAgICk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgc2lnbkFjdGlvbihlbnZlbG9wOiBFbnZlbG9wKTogUHJvbWlzZTxTZWFsZWRFbnZlbG9wPiB7XG4gICAgaWYgKCFlbnZlbG9wLmdhc1ByaWNlKSB7XG4gICAgICBjb25zdCBwcmljZSA9IGF3YWl0IHRoaXMuY2xpZW50LnN1Z2dlc3RHYXNQcmljZSh7fSk7XG4gICAgICBlbnZlbG9wLmdhc1ByaWNlID0gU3RyaW5nKHByaWNlLmdhc1ByaWNlKTtcbiAgICB9XG5cbiAgICBpZiAoIWVudmVsb3AuZ2FzTGltaXQpIHtcbiAgICAgIGNvbnN0IHNlbHAgPSBhd2FpdCBTZWFsZWRFbnZlbG9wLnNpZ24odGhpcy5hY2NvdW50LCBlbnZlbG9wKTtcbiAgICAgIGNvbnN0IGxpbWl0ID0gYXdhaXQgdGhpcy5jbGllbnQuZXN0aW1hdGVHYXNGb3JBY3Rpb24oe1xuICAgICAgICBhY3Rpb246IHNlbHAuYWN0aW9uKClcbiAgICAgIH0pO1xuICAgICAgZW52ZWxvcC5nYXNMaW1pdCA9IGxpbWl0LmdhcztcbiAgICB9XG5cbiAgICByZXR1cm4gU2VhbGVkRW52ZWxvcC5zaWduKHRoaXMuYWNjb3VudCwgZW52ZWxvcCk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgc2VuZEFjdGlvbihlbnZlbG9wOiBFbnZlbG9wKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBzZWxwID0gYXdhaXQgdGhpcy5zaWduQWN0aW9uKGVudmVsb3ApO1xuXG4gICAgYXdhaXQgdGhpcy5jbGllbnQuc2VuZEFjdGlvbih7XG4gICAgICBhY3Rpb246IHNlbHAuYWN0aW9uKClcbiAgICB9KTtcblxuICAgIHJldHVybiBzZWxwLmhhc2goKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgVHJhbnNmZXJNZXRob2QgZXh0ZW5kcyBBYnN0cmFjdE1ldGhvZCB7XG4gIHB1YmxpYyB0cmFuc2ZlcjogVHJhbnNmZXI7XG5cbiAgY29uc3RydWN0b3IoY2xpZW50OiBJUnBjTWV0aG9kLCBhY2NvdW50OiBBY2NvdW50LCB0cmFuc2ZlcjogVHJhbnNmZXIpIHtcbiAgICBzdXBlcihjbGllbnQsIGFjY291bnQpO1xuICAgIHRoaXMudHJhbnNmZXIgPSB0cmFuc2ZlcjtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBleGVjdXRlKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgY29uc3QgZW52ZWxvcCA9IGF3YWl0IHRoaXMuYmFzZUVudmVsb3AoXG4gICAgICB0aGlzLnRyYW5zZmVyLmdhc0xpbWl0LFxuICAgICAgdGhpcy50cmFuc2Zlci5nYXNQcmljZVxuICAgICk7XG4gICAgZW52ZWxvcC50cmFuc2ZlciA9IHtcbiAgICAgIGFtb3VudDogdGhpcy50cmFuc2Zlci5hbW91bnQsXG4gICAgICByZWNpcGllbnQ6IHRoaXMudHJhbnNmZXIucmVjaXBpZW50LFxuICAgICAgcGF5bG9hZDogQnVmZmVyLmZyb20odGhpcy50cmFuc2Zlci5wYXlsb2FkLCBcImhleFwiKVxuICAgIH07XG5cbiAgICByZXR1cm4gdGhpcy5zZW5kQWN0aW9uKGVudmVsb3ApO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBFeGVjdXRpb25NZXRob2QgZXh0ZW5kcyBBYnN0cmFjdE1ldGhvZCB7XG4gIHB1YmxpYyBleGVjdXRpb246IEV4ZWN1dGlvbjtcblxuICBjb25zdHJ1Y3RvcihjbGllbnQ6IElScGNNZXRob2QsIGFjY291bnQ6IEFjY291bnQsIGV4ZWN1dGlvbjogRXhlY3V0aW9uKSB7XG4gICAgc3VwZXIoY2xpZW50LCBhY2NvdW50KTtcbiAgICB0aGlzLmV4ZWN1dGlvbiA9IGV4ZWN1dGlvbjtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBleGVjdXRlKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgY29uc3QgZW52ZWxvcCA9IGF3YWl0IHRoaXMuYmFzZUVudmVsb3AoXG4gICAgICB0aGlzLmV4ZWN1dGlvbi5nYXNMaW1pdCxcbiAgICAgIHRoaXMuZXhlY3V0aW9uLmdhc1ByaWNlXG4gICAgKTtcbiAgICBlbnZlbG9wLmV4ZWN1dGlvbiA9IHtcbiAgICAgIGFtb3VudDogdGhpcy5leGVjdXRpb24uYW1vdW50LFxuICAgICAgY29udHJhY3Q6IHRoaXMuZXhlY3V0aW9uLmNvbnRyYWN0LFxuICAgICAgZGF0YTogdGhpcy5leGVjdXRpb24uZGF0YVxuICAgIH07XG5cbiAgICByZXR1cm4gdGhpcy5zZW5kQWN0aW9uKGVudmVsb3ApO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIHNpZ24oKTogUHJvbWlzZTxJQWN0aW9uPiB7XG4gICAgY29uc3QgZW52ZWxvcCA9IGF3YWl0IHRoaXMuYmFzZUVudmVsb3AoXG4gICAgICB0aGlzLmV4ZWN1dGlvbi5nYXNMaW1pdCxcbiAgICAgIHRoaXMuZXhlY3V0aW9uLmdhc1ByaWNlXG4gICAgKTtcbiAgICBlbnZlbG9wLmV4ZWN1dGlvbiA9IHtcbiAgICAgIGFtb3VudDogdGhpcy5leGVjdXRpb24uYW1vdW50LFxuICAgICAgY29udHJhY3Q6IHRoaXMuZXhlY3V0aW9uLmNvbnRyYWN0LFxuICAgICAgZGF0YTogdGhpcy5leGVjdXRpb24uZGF0YVxuICAgIH07XG5cbiAgICBjb25zdCBzZWxwID0gYXdhaXQgdGhpcy5zaWduQWN0aW9uKGVudmVsb3ApO1xuICAgIHJldHVybiBzZWxwLmFjdGlvbigpO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBDbGFpbUZyb21SZXdhcmRpbmdGdW5kTWV0aG9kIGV4dGVuZHMgQWJzdHJhY3RNZXRob2Qge1xuICBwdWJsaWMgY2xhaW1Gcm9uUmV3YXJkRnVuZDogQ2xhaW1Gcm9tUmV3YXJkaW5nRnVuZDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBjbGllbnQ6IElScGNNZXRob2QsXG4gICAgYWNjb3VudDogQWNjb3VudCxcbiAgICBjbGFpbTogQ2xhaW1Gcm9tUmV3YXJkaW5nRnVuZFxuICApIHtcbiAgICBzdXBlcihjbGllbnQsIGFjY291bnQpO1xuICAgIHRoaXMuY2xhaW1Gcm9uUmV3YXJkRnVuZCA9IGNsYWltO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIGV4ZWN1dGUoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBlbnZlbG9wID0gYXdhaXQgdGhpcy5iYXNlRW52ZWxvcChcbiAgICAgIHRoaXMuY2xhaW1Gcm9uUmV3YXJkRnVuZC5nYXNMaW1pdCxcbiAgICAgIHRoaXMuY2xhaW1Gcm9uUmV3YXJkRnVuZC5nYXNQcmljZVxuICAgICk7XG4gICAgZW52ZWxvcC5jbGFpbUZyb21SZXdhcmRpbmdGdW5kID0ge1xuICAgICAgYW1vdW50OiB0aGlzLmNsYWltRnJvblJld2FyZEZ1bmQuYW1vdW50LFxuICAgICAgZGF0YTogdGhpcy5jbGFpbUZyb25SZXdhcmRGdW5kLmRhdGFcbiAgICB9O1xuXG4gICAgcmV0dXJuIHRoaXMuc2VuZEFjdGlvbihlbnZlbG9wKTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBzaWduKCk6IFByb21pc2U8SUFjdGlvbj4ge1xuICAgIGNvbnN0IGVudmVsb3AgPSBhd2FpdCB0aGlzLmJhc2VFbnZlbG9wKFxuICAgICAgdGhpcy5jbGFpbUZyb25SZXdhcmRGdW5kLmdhc0xpbWl0LFxuICAgICAgdGhpcy5jbGFpbUZyb25SZXdhcmRGdW5kLmdhc1ByaWNlXG4gICAgKTtcbiAgICBlbnZlbG9wLmNsYWltRnJvbVJld2FyZGluZ0Z1bmQgPSB7XG4gICAgICBhbW91bnQ6IHRoaXMuY2xhaW1Gcm9uUmV3YXJkRnVuZC5hbW91bnQsXG4gICAgICBkYXRhOiB0aGlzLmNsYWltRnJvblJld2FyZEZ1bmQuZGF0YVxuICAgIH07XG5cbiAgICBjb25zdCBzZWxwID0gYXdhaXQgdGhpcy5zaWduQWN0aW9uKGVudmVsb3ApO1xuICAgIHJldHVybiBzZWxwLmFjdGlvbigpO1xuICB9XG59XG4iXX0=
