"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SealedEnvelop = exports.Envelop = void 0;

var _action_pb = _interopRequireDefault(
  require("../../protogen/proto/types/action_pb")
);

var _crypto = require("../crypto/crypto");

var _hash = require("../crypto/hash");

var _types = require("../rpc-method/types");

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }
  return obj;
}

class Envelop {
  // optional fields
  constructor(version, nonce, gasLimit, gasPrice) {
    _defineProperty(this, "version", void 0);

    _defineProperty(this, "nonce", void 0);

    _defineProperty(this, "gasLimit", void 0);

    _defineProperty(this, "gasPrice", void 0);

    _defineProperty(this, "transfer", void 0);

    _defineProperty(this, "execution", void 0);

    _defineProperty(this, "startSubChain", void 0);

    _defineProperty(this, "stopSubChain", void 0);

    _defineProperty(this, "putBlock", void 0);

    _defineProperty(this, "createDeposit", void 0);

    _defineProperty(this, "settleDeposit", void 0);

    _defineProperty(this, "createPlumChain", void 0);

    _defineProperty(this, "terminatePlumChain", void 0);

    _defineProperty(this, "plumPutBlock", void 0);

    _defineProperty(this, "plumCreateDeposit", void 0);

    _defineProperty(this, "plumStartExit", void 0);

    _defineProperty(this, "plumChallengeExit", void 0);

    _defineProperty(this, "plumResponseChallengeExit", void 0);

    _defineProperty(this, "plumFinalizeExit", void 0);

    _defineProperty(this, "plumSettleDeposit", void 0);

    _defineProperty(this, "plumTransfer", void 0);

    _defineProperty(this, "depositToRewardingFund", void 0);

    _defineProperty(this, "claimFromRewardingFund", void 0);

    _defineProperty(this, "grantReward", void 0);

    _defineProperty(this, "putPollResult", void 0);

    this.version = version;
    this.nonce = nonce;
    this.gasLimit = gasLimit;
    this.gasPrice = gasPrice;
  }

  core() {
    const gasLimit = this.gasLimit || "0";
    const gasPrice = this.gasPrice || "0";
    const pbActionCore = new _action_pb.default.ActionCore();
    pbActionCore.setVersion(this.version);
    pbActionCore.setNonce(Number(this.nonce));
    pbActionCore.setGaslimit(Number(gasLimit));
    pbActionCore.setGasprice(gasPrice);
    pbActionCore.setTransfer((0, _types.toActionTransfer)(this.transfer));
    pbActionCore.setExecution((0, _types.toActionExecution)(this.execution));
    pbActionCore.setStartsubchain(
      (0, _types.toActionStartSubChain)(this.startSubChain)
    );
    pbActionCore.setStopsubchain(
      (0, _types.toActionStopSubChain)(this.stopSubChain)
    );
    pbActionCore.setPutblock((0, _types.toActionPutBlock)(this.putBlock));
    pbActionCore.setCreatedeposit(
      (0, _types.toActionCreateDeposit)(this.createDeposit)
    );
    pbActionCore.setSettledeposit(
      (0, _types.toActionSettleDeposit)(this.settleDeposit)
    );
    pbActionCore.setCreateplumchain(
      (0, _types.toActionCreatePlumChain)(this.createPlumChain)
    );
    pbActionCore.setTerminateplumchain(
      (0, _types.toActionTerminatePlumChain)(this.terminatePlumChain)
    );
    pbActionCore.setPlumputblock(
      (0, _types.toActionPlumPutBlock)(this.plumPutBlock)
    );
    pbActionCore.setPlumcreatedeposit(
      (0, _types.toActionPlumCreateDeposit)(this.plumCreateDeposit)
    );
    pbActionCore.setPlumstartexit(
      (0, _types.toActionPlumStartExit)(this.plumStartExit)
    );
    pbActionCore.setPlumchallengeexit(
      (0, _types.toActionPlumChallengeExit)(this.plumChallengeExit)
    );
    pbActionCore.setPlumresponsechallengeexit(
      (0, _types.toActionPlumResponseChallengeExit)(
        this.plumResponseChallengeExit
      )
    );
    pbActionCore.setPlumfinalizeexit(
      (0, _types.toActionPlumFinalizeExit)(this.plumFinalizeExit)
    );
    pbActionCore.setPlumsettledeposit(
      (0, _types.toActionPlumSettleDeposit)(this.plumSettleDeposit)
    );
    pbActionCore.setPlumtransfer(
      (0, _types.toActionPlumTransfer)(this.plumTransfer)
    );
    pbActionCore.setDeposittorewardingfund(
      (0, _types.toActionDepositToRewardingFund)(this.depositToRewardingFund)
    );
    pbActionCore.setClaimfromrewardingfund(
      (0, _types.toActionClaimFromRewardingFund)(this.claimFromRewardingFund)
    );
    pbActionCore.setGrantreward(
      (0, _types.toActionGrantReward)(this.grantReward)
    );
    return pbActionCore;
  }

  bytestream() {
    return this.core().serializeBinary();
  }
}

exports.Envelop = Envelop;

class SealedEnvelop {
  constructor(act, senderPubKey, signature) {
    _defineProperty(this, "act", void 0);

    _defineProperty(this, "senderPubKey", void 0);

    _defineProperty(this, "signature", void 0);

    this.act = act;
    this.senderPubKey = senderPubKey;
    this.signature = signature;
  }

  bytestream() {
    const pbActionCore = this.act.core();
    const pbAction = new _action_pb.default.Action();
    pbAction.setCore(pbActionCore);
    pbAction.setSenderpubkey(this.senderPubKey);
    pbAction.setSignature(this.signature);
    return pbAction.serializeBinary();
  }

  hash() {
    return Buffer.from((0, _hash.hash256b)(this.bytestream())).toString("hex");
  }

  action() {
    const gasLimit = this.act.gasLimit || "0";
    const gasPrice = this.act.gasPrice || "0";
    return {
      core: {
        version: this.act.version,
        nonce: this.act.nonce,
        gasLimit: gasLimit,
        gasPrice: gasPrice,
        transfer: this.act.transfer,
        execution: this.act.execution,
        startSubChain: this.act.startSubChain,
        stopSubChain: this.act.stopSubChain,
        putBlock: this.act.putBlock,
        createDeposit: this.act.createDeposit,
        settleDeposit: this.act.settleDeposit,
        createPlumChain: this.act.createPlumChain,
        terminatePlumChain: this.act.terminatePlumChain,
        plumPutBlock: this.act.plumPutBlock,
        plumCreateDeposit: this.act.plumCreateDeposit,
        plumStartExit: this.act.plumStartExit,
        plumChallengeExit: this.act.plumChallengeExit,
        plumResponseChallengeExit: this.act.plumResponseChallengeExit,
        plumFinalizeExit: this.act.plumFinalizeExit,
        plumSettleDeposit: this.act.plumSettleDeposit,
        plumTransfer: this.act.plumTransfer,
        depositToRewardingFund: this.act.depositToRewardingFund,
        claimFromRewardingFund: this.act.claimFromRewardingFund,
        grantReward: this.act.grantReward,
        putPollResult: this.act.putPollResult
      },
      senderPubKey: this.senderPubKey,
      signature: this.signature
    };
  }

  static async sign(account, act) {
    const h = (0, _hash.hash256b)(act.bytestream());

    if (account.signer) {
      const signdData = await account.signer.sign(account.address, h);
      return new SealedEnvelop(
        act,
        Buffer.from(signdData.publicKey, "hex"),
        signdData.data
      );
    } else {
      const sign = Buffer.from(
        (0, _crypto.makeSigner)(0)(h.toString("hex"), account.privateKey),
        "hex"
      );
      return new SealedEnvelop(
        act,
        Buffer.from(account.publicKey, "hex"),
        sign
      );
    }
  }
}

exports.SealedEnvelop = SealedEnvelop;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hY3Rpb24vZW52ZWxvcC50cyJdLCJuYW1lcyI6WyJFbnZlbG9wIiwiY29uc3RydWN0b3IiLCJ2ZXJzaW9uIiwibm9uY2UiLCJnYXNMaW1pdCIsImdhc1ByaWNlIiwiY29yZSIsInBiQWN0aW9uQ29yZSIsImFjdGlvblBiIiwiQWN0aW9uQ29yZSIsInNldFZlcnNpb24iLCJzZXROb25jZSIsIk51bWJlciIsInNldEdhc2xpbWl0Iiwic2V0R2FzcHJpY2UiLCJzZXRUcmFuc2ZlciIsInRyYW5zZmVyIiwic2V0RXhlY3V0aW9uIiwiZXhlY3V0aW9uIiwic2V0U3RhcnRzdWJjaGFpbiIsInN0YXJ0U3ViQ2hhaW4iLCJzZXRTdG9wc3ViY2hhaW4iLCJzdG9wU3ViQ2hhaW4iLCJzZXRQdXRibG9jayIsInB1dEJsb2NrIiwic2V0Q3JlYXRlZGVwb3NpdCIsImNyZWF0ZURlcG9zaXQiLCJzZXRTZXR0bGVkZXBvc2l0Iiwic2V0dGxlRGVwb3NpdCIsInNldENyZWF0ZXBsdW1jaGFpbiIsImNyZWF0ZVBsdW1DaGFpbiIsInNldFRlcm1pbmF0ZXBsdW1jaGFpbiIsInRlcm1pbmF0ZVBsdW1DaGFpbiIsInNldFBsdW1wdXRibG9jayIsInBsdW1QdXRCbG9jayIsInNldFBsdW1jcmVhdGVkZXBvc2l0IiwicGx1bUNyZWF0ZURlcG9zaXQiLCJzZXRQbHVtc3RhcnRleGl0IiwicGx1bVN0YXJ0RXhpdCIsInNldFBsdW1jaGFsbGVuZ2VleGl0IiwicGx1bUNoYWxsZW5nZUV4aXQiLCJzZXRQbHVtcmVzcG9uc2VjaGFsbGVuZ2VleGl0IiwicGx1bVJlc3BvbnNlQ2hhbGxlbmdlRXhpdCIsInNldFBsdW1maW5hbGl6ZWV4aXQiLCJwbHVtRmluYWxpemVFeGl0Iiwic2V0UGx1bXNldHRsZWRlcG9zaXQiLCJwbHVtU2V0dGxlRGVwb3NpdCIsInNldFBsdW10cmFuc2ZlciIsInBsdW1UcmFuc2ZlciIsInNldERlcG9zaXR0b3Jld2FyZGluZ2Z1bmQiLCJkZXBvc2l0VG9SZXdhcmRpbmdGdW5kIiwic2V0Q2xhaW1mcm9tcmV3YXJkaW5nZnVuZCIsImNsYWltRnJvbVJld2FyZGluZ0Z1bmQiLCJzZXRHcmFudHJld2FyZCIsImdyYW50UmV3YXJkIiwiYnl0ZXN0cmVhbSIsInNlcmlhbGl6ZUJpbmFyeSIsIlNlYWxlZEVudmVsb3AiLCJhY3QiLCJzZW5kZXJQdWJLZXkiLCJzaWduYXR1cmUiLCJwYkFjdGlvbiIsIkFjdGlvbiIsInNldENvcmUiLCJzZXRTZW5kZXJwdWJrZXkiLCJzZXRTaWduYXR1cmUiLCJoYXNoIiwiQnVmZmVyIiwiZnJvbSIsInRvU3RyaW5nIiwiYWN0aW9uIiwicHV0UG9sbFJlc3VsdCIsInNpZ24iLCJhY2NvdW50IiwiaCIsInNpZ25lciIsInNpZ25kRGF0YSIsImFkZHJlc3MiLCJwdWJsaWNLZXkiLCJkYXRhIiwicHJpdmF0ZUtleSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUVBOztBQUNBOztBQUNBOzs7Ozs7QUE2Q08sTUFBTUEsT0FBTixDQUFjO0FBTW5CO0FBdUJBQyxFQUFBQSxXQUFXLENBQ1RDLE9BRFMsRUFFVEMsS0FGUyxFQUdUQyxRQUhTLEVBSVRDLFFBSlMsRUFLVDtBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUNBLFNBQUtILE9BQUwsR0FBZUEsT0FBZjtBQUNBLFNBQUtDLEtBQUwsR0FBYUEsS0FBYjtBQUNBLFNBQUtDLFFBQUwsR0FBZ0JBLFFBQWhCO0FBQ0EsU0FBS0MsUUFBTCxHQUFnQkEsUUFBaEI7QUFDRDs7QUFFTUMsRUFBQUEsSUFBUCxHQUFtQztBQUNqQyxVQUFNRixRQUFRLEdBQUcsS0FBS0EsUUFBTCxJQUFpQixHQUFsQztBQUNBLFVBQU1DLFFBQVEsR0FBRyxLQUFLQSxRQUFMLElBQWlCLEdBQWxDO0FBRUEsVUFBTUUsWUFBWSxHQUFHLElBQUlDLG1CQUFTQyxVQUFiLEVBQXJCO0FBQ0FGLElBQUFBLFlBQVksQ0FBQ0csVUFBYixDQUF3QixLQUFLUixPQUE3QjtBQUNBSyxJQUFBQSxZQUFZLENBQUNJLFFBQWIsQ0FBc0JDLE1BQU0sQ0FBQyxLQUFLVCxLQUFOLENBQTVCO0FBQ0FJLElBQUFBLFlBQVksQ0FBQ00sV0FBYixDQUF5QkQsTUFBTSxDQUFDUixRQUFELENBQS9CO0FBQ0FHLElBQUFBLFlBQVksQ0FBQ08sV0FBYixDQUF5QlQsUUFBekI7QUFDQUUsSUFBQUEsWUFBWSxDQUFDUSxXQUFiLENBQXlCLDZCQUFpQixLQUFLQyxRQUF0QixDQUF6QjtBQUNBVCxJQUFBQSxZQUFZLENBQUNVLFlBQWIsQ0FBMEIsOEJBQWtCLEtBQUtDLFNBQXZCLENBQTFCO0FBQ0FYLElBQUFBLFlBQVksQ0FBQ1ksZ0JBQWIsQ0FBOEIsa0NBQXNCLEtBQUtDLGFBQTNCLENBQTlCO0FBQ0FiLElBQUFBLFlBQVksQ0FBQ2MsZUFBYixDQUE2QixpQ0FBcUIsS0FBS0MsWUFBMUIsQ0FBN0I7QUFDQWYsSUFBQUEsWUFBWSxDQUFDZ0IsV0FBYixDQUF5Qiw2QkFBaUIsS0FBS0MsUUFBdEIsQ0FBekI7QUFDQWpCLElBQUFBLFlBQVksQ0FBQ2tCLGdCQUFiLENBQThCLGtDQUFzQixLQUFLQyxhQUEzQixDQUE5QjtBQUNBbkIsSUFBQUEsWUFBWSxDQUFDb0IsZ0JBQWIsQ0FBOEIsa0NBQXNCLEtBQUtDLGFBQTNCLENBQTlCO0FBQ0FyQixJQUFBQSxZQUFZLENBQUNzQixrQkFBYixDQUNFLG9DQUF3QixLQUFLQyxlQUE3QixDQURGO0FBR0F2QixJQUFBQSxZQUFZLENBQUN3QixxQkFBYixDQUNFLHVDQUEyQixLQUFLQyxrQkFBaEMsQ0FERjtBQUdBekIsSUFBQUEsWUFBWSxDQUFDMEIsZUFBYixDQUE2QixpQ0FBcUIsS0FBS0MsWUFBMUIsQ0FBN0I7QUFDQTNCLElBQUFBLFlBQVksQ0FBQzRCLG9CQUFiLENBQ0Usc0NBQTBCLEtBQUtDLGlCQUEvQixDQURGO0FBR0E3QixJQUFBQSxZQUFZLENBQUM4QixnQkFBYixDQUE4QixrQ0FBc0IsS0FBS0MsYUFBM0IsQ0FBOUI7QUFDQS9CLElBQUFBLFlBQVksQ0FBQ2dDLG9CQUFiLENBQ0Usc0NBQTBCLEtBQUtDLGlCQUEvQixDQURGO0FBR0FqQyxJQUFBQSxZQUFZLENBQUNrQyw0QkFBYixDQUNFLDhDQUFrQyxLQUFLQyx5QkFBdkMsQ0FERjtBQUdBbkMsSUFBQUEsWUFBWSxDQUFDb0MsbUJBQWIsQ0FDRSxxQ0FBeUIsS0FBS0MsZ0JBQTlCLENBREY7QUFHQXJDLElBQUFBLFlBQVksQ0FBQ3NDLG9CQUFiLENBQ0Usc0NBQTBCLEtBQUtDLGlCQUEvQixDQURGO0FBR0F2QyxJQUFBQSxZQUFZLENBQUN3QyxlQUFiLENBQTZCLGlDQUFxQixLQUFLQyxZQUExQixDQUE3QjtBQUNBekMsSUFBQUEsWUFBWSxDQUFDMEMseUJBQWIsQ0FDRSwyQ0FBK0IsS0FBS0Msc0JBQXBDLENBREY7QUFHQTNDLElBQUFBLFlBQVksQ0FBQzRDLHlCQUFiLENBQ0UsMkNBQStCLEtBQUtDLHNCQUFwQyxDQURGO0FBR0E3QyxJQUFBQSxZQUFZLENBQUM4QyxjQUFiLENBQTRCLGdDQUFvQixLQUFLQyxXQUF6QixDQUE1QjtBQUVBLFdBQU8vQyxZQUFQO0FBQ0Q7O0FBRU1nRCxFQUFBQSxVQUFQLEdBQWdDO0FBQzlCLFdBQU8sS0FBS2pELElBQUwsR0FBWWtELGVBQVosRUFBUDtBQUNEOztBQTlGa0I7Ozs7QUFpR2QsTUFBTUMsYUFBTixDQUFvQjtBQUt6QnhELEVBQUFBLFdBQVcsQ0FBQ3lELEdBQUQsRUFBZUMsWUFBZixFQUFxQ0MsU0FBckMsRUFBd0Q7QUFBQTs7QUFBQTs7QUFBQTs7QUFDakUsU0FBS0YsR0FBTCxHQUFXQSxHQUFYO0FBQ0EsU0FBS0MsWUFBTCxHQUFvQkEsWUFBcEI7QUFDQSxTQUFLQyxTQUFMLEdBQWlCQSxTQUFqQjtBQUNEOztBQUVNTCxFQUFBQSxVQUFQLEdBQWdDO0FBQzlCLFVBQU1oRCxZQUFZLEdBQUcsS0FBS21ELEdBQUwsQ0FBU3BELElBQVQsRUFBckI7QUFDQSxVQUFNdUQsUUFBUSxHQUFHLElBQUlyRCxtQkFBU3NELE1BQWIsRUFBakI7QUFDQUQsSUFBQUEsUUFBUSxDQUFDRSxPQUFULENBQWlCeEQsWUFBakI7QUFDQXNELElBQUFBLFFBQVEsQ0FBQ0csZUFBVCxDQUF5QixLQUFLTCxZQUE5QjtBQUNBRSxJQUFBQSxRQUFRLENBQUNJLFlBQVQsQ0FBc0IsS0FBS0wsU0FBM0I7QUFDQSxXQUFPQyxRQUFRLENBQUNMLGVBQVQsRUFBUDtBQUNEOztBQUVNVSxFQUFBQSxJQUFQLEdBQXNCO0FBQ3BCLFdBQU9DLE1BQU0sQ0FBQ0MsSUFBUCxDQUFZLG9CQUFTLEtBQUtiLFVBQUwsRUFBVCxDQUFaLEVBQXlDYyxRQUF6QyxDQUFrRCxLQUFsRCxDQUFQO0FBQ0Q7O0FBRU1DLEVBQUFBLE1BQVAsR0FBeUI7QUFDdkIsVUFBTWxFLFFBQVEsR0FBRyxLQUFLc0QsR0FBTCxDQUFTdEQsUUFBVCxJQUFxQixHQUF0QztBQUNBLFVBQU1DLFFBQVEsR0FBRyxLQUFLcUQsR0FBTCxDQUFTckQsUUFBVCxJQUFxQixHQUF0QztBQUVBLFdBQU87QUFDTEMsTUFBQUEsSUFBSSxFQUFFO0FBQ0pKLFFBQUFBLE9BQU8sRUFBRSxLQUFLd0QsR0FBTCxDQUFTeEQsT0FEZDtBQUVKQyxRQUFBQSxLQUFLLEVBQUUsS0FBS3VELEdBQUwsQ0FBU3ZELEtBRlo7QUFHSkMsUUFBQUEsUUFBUSxFQUFFQSxRQUhOO0FBSUpDLFFBQUFBLFFBQVEsRUFBRUEsUUFKTjtBQUtKVyxRQUFBQSxRQUFRLEVBQUUsS0FBSzBDLEdBQUwsQ0FBUzFDLFFBTGY7QUFNSkUsUUFBQUEsU0FBUyxFQUFFLEtBQUt3QyxHQUFMLENBQVN4QyxTQU5oQjtBQU9KRSxRQUFBQSxhQUFhLEVBQUUsS0FBS3NDLEdBQUwsQ0FBU3RDLGFBUHBCO0FBUUpFLFFBQUFBLFlBQVksRUFBRSxLQUFLb0MsR0FBTCxDQUFTcEMsWUFSbkI7QUFTSkUsUUFBQUEsUUFBUSxFQUFFLEtBQUtrQyxHQUFMLENBQVNsQyxRQVRmO0FBVUpFLFFBQUFBLGFBQWEsRUFBRSxLQUFLZ0MsR0FBTCxDQUFTaEMsYUFWcEI7QUFXSkUsUUFBQUEsYUFBYSxFQUFFLEtBQUs4QixHQUFMLENBQVM5QixhQVhwQjtBQVlKRSxRQUFBQSxlQUFlLEVBQUUsS0FBSzRCLEdBQUwsQ0FBUzVCLGVBWnRCO0FBYUpFLFFBQUFBLGtCQUFrQixFQUFFLEtBQUswQixHQUFMLENBQVMxQixrQkFiekI7QUFjSkUsUUFBQUEsWUFBWSxFQUFFLEtBQUt3QixHQUFMLENBQVN4QixZQWRuQjtBQWVKRSxRQUFBQSxpQkFBaUIsRUFBRSxLQUFLc0IsR0FBTCxDQUFTdEIsaUJBZnhCO0FBZ0JKRSxRQUFBQSxhQUFhLEVBQUUsS0FBS29CLEdBQUwsQ0FBU3BCLGFBaEJwQjtBQWlCSkUsUUFBQUEsaUJBQWlCLEVBQUUsS0FBS2tCLEdBQUwsQ0FBU2xCLGlCQWpCeEI7QUFrQkpFLFFBQUFBLHlCQUF5QixFQUFFLEtBQUtnQixHQUFMLENBQVNoQix5QkFsQmhDO0FBbUJKRSxRQUFBQSxnQkFBZ0IsRUFBRSxLQUFLYyxHQUFMLENBQVNkLGdCQW5CdkI7QUFvQkpFLFFBQUFBLGlCQUFpQixFQUFFLEtBQUtZLEdBQUwsQ0FBU1osaUJBcEJ4QjtBQXFCSkUsUUFBQUEsWUFBWSxFQUFFLEtBQUtVLEdBQUwsQ0FBU1YsWUFyQm5CO0FBc0JKRSxRQUFBQSxzQkFBc0IsRUFBRSxLQUFLUSxHQUFMLENBQVNSLHNCQXRCN0I7QUF1QkpFLFFBQUFBLHNCQUFzQixFQUFFLEtBQUtNLEdBQUwsQ0FBU04sc0JBdkI3QjtBQXdCSkUsUUFBQUEsV0FBVyxFQUFFLEtBQUtJLEdBQUwsQ0FBU0osV0F4QmxCO0FBeUJKaUIsUUFBQUEsYUFBYSxFQUFFLEtBQUtiLEdBQUwsQ0FBU2E7QUF6QnBCLE9BREQ7QUE0QkxaLE1BQUFBLFlBQVksRUFBRSxLQUFLQSxZQTVCZDtBQTZCTEMsTUFBQUEsU0FBUyxFQUFFLEtBQUtBO0FBN0JYLEtBQVA7QUErQkQ7O0FBRUQsZUFBb0JZLElBQXBCLENBQ0VDLE9BREYsRUFFRWYsR0FGRixFQUcwQjtBQUN4QixVQUFNZ0IsQ0FBQyxHQUFHLG9CQUFTaEIsR0FBRyxDQUFDSCxVQUFKLEVBQVQsQ0FBVjs7QUFDQSxRQUFJa0IsT0FBTyxDQUFDRSxNQUFaLEVBQW9CO0FBQ2xCLFlBQU1DLFNBQVMsR0FBRyxNQUFNSCxPQUFPLENBQUNFLE1BQVIsQ0FBZUgsSUFBZixDQUFvQkMsT0FBTyxDQUFDSSxPQUE1QixFQUFxQ0gsQ0FBckMsQ0FBeEI7QUFDQSxhQUFPLElBQUlqQixhQUFKLENBQ0xDLEdBREssRUFFTFMsTUFBTSxDQUFDQyxJQUFQLENBQVlRLFNBQVMsQ0FBQ0UsU0FBdEIsRUFBaUMsS0FBakMsQ0FGSyxFQUdMRixTQUFTLENBQUNHLElBSEwsQ0FBUDtBQUtELEtBUEQsTUFPTztBQUNMLFlBQU1QLElBQUksR0FBR0wsTUFBTSxDQUFDQyxJQUFQLENBQ1gsd0JBQVcsQ0FBWCxFQUFjTSxDQUFDLENBQUNMLFFBQUYsQ0FBVyxLQUFYLENBQWQsRUFBaUNJLE9BQU8sQ0FBQ08sVUFBekMsQ0FEVyxFQUVYLEtBRlcsQ0FBYjtBQUlBLGFBQU8sSUFBSXZCLGFBQUosQ0FDTEMsR0FESyxFQUVMUyxNQUFNLENBQUNDLElBQVAsQ0FBWUssT0FBTyxDQUFDSyxTQUFwQixFQUErQixLQUEvQixDQUZLLEVBR0xOLElBSEssQ0FBUDtBQUtEO0FBQ0Y7O0FBcEZ3QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhY3Rpb25QYiBmcm9tIFwiLi4vLi4vcHJvdG9nZW4vcHJvdG8vdHlwZXMvYWN0aW9uX3BiXCI7XG5pbXBvcnQgeyBJQWNjb3VudCB9IGZyb20gXCIuLi9hY2NvdW50L2FjY291bnRcIjtcbmltcG9ydCB7IG1ha2VTaWduZXIgfSBmcm9tIFwiLi4vY3J5cHRvL2NyeXB0b1wiO1xuaW1wb3J0IHsgaGFzaDI1NmIgfSBmcm9tIFwiLi4vY3J5cHRvL2hhc2hcIjtcbmltcG9ydCB7XG4gIElBY3Rpb24sXG4gIElDbGFpbUZyb21SZXdhcmRpbmdGdW5kLFxuICBJQ3JlYXRlRGVwb3NpdCxcbiAgSUNyZWF0ZVBsdW1DaGFpbixcbiAgSURlcG9zaXRUb1Jld2FyZGluZ0Z1bmQsXG4gIElFeGVjdXRpb24sXG4gIElHcmFudFJld2FyZCxcbiAgSVBsdW1DaGFsbGVuZ2VFeGl0LFxuICBJUGx1bUNyZWF0ZURlcG9zaXQsXG4gIElQbHVtRmluYWxpemVFeGl0LFxuICBJUGx1bVB1dEJsb2NrLFxuICBJUGx1bVJlc3BvbnNlQ2hhbGxlbmdlRXhpdCxcbiAgSVBsdW1TZXR0bGVEZXBvc2l0LFxuICBJUGx1bVN0YXJ0RXhpdCxcbiAgSVBsdW1UcmFuc2ZlcixcbiAgSVB1dEJsb2NrLFxuICBJUHV0UG9sbFJlc3VsdCxcbiAgSVNldHRsZURlcG9zaXQsXG4gIElTdGFydFN1YkNoYWluLFxuICBJU3RvcFN1YkNoYWluLFxuICBJVGVybWluYXRlUGx1bUNoYWluLFxuICBJVHJhbnNmZXIsXG4gIHRvQWN0aW9uQ2xhaW1Gcm9tUmV3YXJkaW5nRnVuZCxcbiAgdG9BY3Rpb25DcmVhdGVEZXBvc2l0LFxuICB0b0FjdGlvbkNyZWF0ZVBsdW1DaGFpbixcbiAgdG9BY3Rpb25EZXBvc2l0VG9SZXdhcmRpbmdGdW5kLFxuICB0b0FjdGlvbkV4ZWN1dGlvbixcbiAgdG9BY3Rpb25HcmFudFJld2FyZCxcbiAgdG9BY3Rpb25QbHVtQ2hhbGxlbmdlRXhpdCxcbiAgdG9BY3Rpb25QbHVtQ3JlYXRlRGVwb3NpdCxcbiAgdG9BY3Rpb25QbHVtRmluYWxpemVFeGl0LFxuICB0b0FjdGlvblBsdW1QdXRCbG9jayxcbiAgdG9BY3Rpb25QbHVtUmVzcG9uc2VDaGFsbGVuZ2VFeGl0LFxuICB0b0FjdGlvblBsdW1TZXR0bGVEZXBvc2l0LFxuICB0b0FjdGlvblBsdW1TdGFydEV4aXQsXG4gIHRvQWN0aW9uUGx1bVRyYW5zZmVyLFxuICB0b0FjdGlvblB1dEJsb2NrLFxuICB0b0FjdGlvblNldHRsZURlcG9zaXQsXG4gIHRvQWN0aW9uU3RhcnRTdWJDaGFpbixcbiAgdG9BY3Rpb25TdG9wU3ViQ2hhaW4sXG4gIHRvQWN0aW9uVGVybWluYXRlUGx1bUNoYWluLFxuICB0b0FjdGlvblRyYW5zZmVyXG59IGZyb20gXCIuLi9ycGMtbWV0aG9kL3R5cGVzXCI7XG5cbmV4cG9ydCBjbGFzcyBFbnZlbG9wIHtcbiAgcHVibGljIHZlcnNpb246IG51bWJlcjtcbiAgcHVibGljIG5vbmNlOiBzdHJpbmc7XG4gIHB1YmxpYyBnYXNMaW1pdD86IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgcHVibGljIGdhc1ByaWNlPzogc3RyaW5nIHwgdW5kZWZpbmVkO1xuXG4gIC8vIG9wdGlvbmFsIGZpZWxkc1xuICBwdWJsaWMgdHJhbnNmZXI/OiBJVHJhbnNmZXIgfCB1bmRlZmluZWQ7XG4gIHB1YmxpYyBleGVjdXRpb24/OiBJRXhlY3V0aW9uIHwgdW5kZWZpbmVkO1xuICBwdWJsaWMgc3RhcnRTdWJDaGFpbj86IElTdGFydFN1YkNoYWluIHwgdW5kZWZpbmVkO1xuICBwdWJsaWMgc3RvcFN1YkNoYWluPzogSVN0b3BTdWJDaGFpbiB8IHVuZGVmaW5lZDtcbiAgcHVibGljIHB1dEJsb2NrPzogSVB1dEJsb2NrIHwgdW5kZWZpbmVkO1xuICBwdWJsaWMgY3JlYXRlRGVwb3NpdD86IElDcmVhdGVEZXBvc2l0IHwgdW5kZWZpbmVkO1xuICBwdWJsaWMgc2V0dGxlRGVwb3NpdD86IElTZXR0bGVEZXBvc2l0IHwgdW5kZWZpbmVkO1xuICBwdWJsaWMgY3JlYXRlUGx1bUNoYWluPzogSUNyZWF0ZVBsdW1DaGFpbiB8IHVuZGVmaW5lZDtcbiAgcHVibGljIHRlcm1pbmF0ZVBsdW1DaGFpbj86IElUZXJtaW5hdGVQbHVtQ2hhaW4gfCB1bmRlZmluZWQ7XG4gIHB1YmxpYyBwbHVtUHV0QmxvY2s/OiBJUGx1bVB1dEJsb2NrIHwgdW5kZWZpbmVkO1xuICBwdWJsaWMgcGx1bUNyZWF0ZURlcG9zaXQ/OiBJUGx1bUNyZWF0ZURlcG9zaXQgfCB1bmRlZmluZWQ7XG4gIHB1YmxpYyBwbHVtU3RhcnRFeGl0PzogSVBsdW1TdGFydEV4aXQgfCB1bmRlZmluZWQ7XG4gIHB1YmxpYyBwbHVtQ2hhbGxlbmdlRXhpdD86IElQbHVtQ2hhbGxlbmdlRXhpdCB8IHVuZGVmaW5lZDtcbiAgcHVibGljIHBsdW1SZXNwb25zZUNoYWxsZW5nZUV4aXQ/OiBJUGx1bVJlc3BvbnNlQ2hhbGxlbmdlRXhpdCB8IHVuZGVmaW5lZDtcbiAgcHVibGljIHBsdW1GaW5hbGl6ZUV4aXQ/OiBJUGx1bUZpbmFsaXplRXhpdCB8IHVuZGVmaW5lZDtcbiAgcHVibGljIHBsdW1TZXR0bGVEZXBvc2l0PzogSVBsdW1TZXR0bGVEZXBvc2l0IHwgdW5kZWZpbmVkO1xuICBwdWJsaWMgcGx1bVRyYW5zZmVyPzogSVBsdW1UcmFuc2ZlciB8IHVuZGVmaW5lZDtcbiAgcHVibGljIGRlcG9zaXRUb1Jld2FyZGluZ0Z1bmQ/OiBJRGVwb3NpdFRvUmV3YXJkaW5nRnVuZCB8IHVuZGVmaW5lZDtcbiAgcHVibGljIGNsYWltRnJvbVJld2FyZGluZ0Z1bmQ/OiBJQ2xhaW1Gcm9tUmV3YXJkaW5nRnVuZCB8IHVuZGVmaW5lZDtcbiAgcHVibGljIGdyYW50UmV3YXJkPzogSUdyYW50UmV3YXJkIHwgdW5kZWZpbmVkO1xuICBwdWJsaWMgcHV0UG9sbFJlc3VsdD86IElQdXRQb2xsUmVzdWx0IHwgdW5kZWZpbmVkO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHZlcnNpb246IG51bWJlcixcbiAgICBub25jZTogc3RyaW5nLFxuICAgIGdhc0xpbWl0Pzogc3RyaW5nLFxuICAgIGdhc1ByaWNlPzogc3RyaW5nXG4gICkge1xuICAgIHRoaXMudmVyc2lvbiA9IHZlcnNpb247XG4gICAgdGhpcy5ub25jZSA9IG5vbmNlO1xuICAgIHRoaXMuZ2FzTGltaXQgPSBnYXNMaW1pdDtcbiAgICB0aGlzLmdhc1ByaWNlID0gZ2FzUHJpY2U7XG4gIH1cblxuICBwdWJsaWMgY29yZSgpOiBhY3Rpb25QYi5BY3Rpb25Db3JlIHtcbiAgICBjb25zdCBnYXNMaW1pdCA9IHRoaXMuZ2FzTGltaXQgfHwgXCIwXCI7XG4gICAgY29uc3QgZ2FzUHJpY2UgPSB0aGlzLmdhc1ByaWNlIHx8IFwiMFwiO1xuXG4gICAgY29uc3QgcGJBY3Rpb25Db3JlID0gbmV3IGFjdGlvblBiLkFjdGlvbkNvcmUoKTtcbiAgICBwYkFjdGlvbkNvcmUuc2V0VmVyc2lvbih0aGlzLnZlcnNpb24pO1xuICAgIHBiQWN0aW9uQ29yZS5zZXROb25jZShOdW1iZXIodGhpcy5ub25jZSkpO1xuICAgIHBiQWN0aW9uQ29yZS5zZXRHYXNsaW1pdChOdW1iZXIoZ2FzTGltaXQpKTtcbiAgICBwYkFjdGlvbkNvcmUuc2V0R2FzcHJpY2UoZ2FzUHJpY2UpO1xuICAgIHBiQWN0aW9uQ29yZS5zZXRUcmFuc2Zlcih0b0FjdGlvblRyYW5zZmVyKHRoaXMudHJhbnNmZXIpKTtcbiAgICBwYkFjdGlvbkNvcmUuc2V0RXhlY3V0aW9uKHRvQWN0aW9uRXhlY3V0aW9uKHRoaXMuZXhlY3V0aW9uKSk7XG4gICAgcGJBY3Rpb25Db3JlLnNldFN0YXJ0c3ViY2hhaW4odG9BY3Rpb25TdGFydFN1YkNoYWluKHRoaXMuc3RhcnRTdWJDaGFpbikpO1xuICAgIHBiQWN0aW9uQ29yZS5zZXRTdG9wc3ViY2hhaW4odG9BY3Rpb25TdG9wU3ViQ2hhaW4odGhpcy5zdG9wU3ViQ2hhaW4pKTtcbiAgICBwYkFjdGlvbkNvcmUuc2V0UHV0YmxvY2sodG9BY3Rpb25QdXRCbG9jayh0aGlzLnB1dEJsb2NrKSk7XG4gICAgcGJBY3Rpb25Db3JlLnNldENyZWF0ZWRlcG9zaXQodG9BY3Rpb25DcmVhdGVEZXBvc2l0KHRoaXMuY3JlYXRlRGVwb3NpdCkpO1xuICAgIHBiQWN0aW9uQ29yZS5zZXRTZXR0bGVkZXBvc2l0KHRvQWN0aW9uU2V0dGxlRGVwb3NpdCh0aGlzLnNldHRsZURlcG9zaXQpKTtcbiAgICBwYkFjdGlvbkNvcmUuc2V0Q3JlYXRlcGx1bWNoYWluKFxuICAgICAgdG9BY3Rpb25DcmVhdGVQbHVtQ2hhaW4odGhpcy5jcmVhdGVQbHVtQ2hhaW4pXG4gICAgKTtcbiAgICBwYkFjdGlvbkNvcmUuc2V0VGVybWluYXRlcGx1bWNoYWluKFxuICAgICAgdG9BY3Rpb25UZXJtaW5hdGVQbHVtQ2hhaW4odGhpcy50ZXJtaW5hdGVQbHVtQ2hhaW4pXG4gICAgKTtcbiAgICBwYkFjdGlvbkNvcmUuc2V0UGx1bXB1dGJsb2NrKHRvQWN0aW9uUGx1bVB1dEJsb2NrKHRoaXMucGx1bVB1dEJsb2NrKSk7XG4gICAgcGJBY3Rpb25Db3JlLnNldFBsdW1jcmVhdGVkZXBvc2l0KFxuICAgICAgdG9BY3Rpb25QbHVtQ3JlYXRlRGVwb3NpdCh0aGlzLnBsdW1DcmVhdGVEZXBvc2l0KVxuICAgICk7XG4gICAgcGJBY3Rpb25Db3JlLnNldFBsdW1zdGFydGV4aXQodG9BY3Rpb25QbHVtU3RhcnRFeGl0KHRoaXMucGx1bVN0YXJ0RXhpdCkpO1xuICAgIHBiQWN0aW9uQ29yZS5zZXRQbHVtY2hhbGxlbmdlZXhpdChcbiAgICAgIHRvQWN0aW9uUGx1bUNoYWxsZW5nZUV4aXQodGhpcy5wbHVtQ2hhbGxlbmdlRXhpdClcbiAgICApO1xuICAgIHBiQWN0aW9uQ29yZS5zZXRQbHVtcmVzcG9uc2VjaGFsbGVuZ2VleGl0KFxuICAgICAgdG9BY3Rpb25QbHVtUmVzcG9uc2VDaGFsbGVuZ2VFeGl0KHRoaXMucGx1bVJlc3BvbnNlQ2hhbGxlbmdlRXhpdClcbiAgICApO1xuICAgIHBiQWN0aW9uQ29yZS5zZXRQbHVtZmluYWxpemVleGl0KFxuICAgICAgdG9BY3Rpb25QbHVtRmluYWxpemVFeGl0KHRoaXMucGx1bUZpbmFsaXplRXhpdClcbiAgICApO1xuICAgIHBiQWN0aW9uQ29yZS5zZXRQbHVtc2V0dGxlZGVwb3NpdChcbiAgICAgIHRvQWN0aW9uUGx1bVNldHRsZURlcG9zaXQodGhpcy5wbHVtU2V0dGxlRGVwb3NpdClcbiAgICApO1xuICAgIHBiQWN0aW9uQ29yZS5zZXRQbHVtdHJhbnNmZXIodG9BY3Rpb25QbHVtVHJhbnNmZXIodGhpcy5wbHVtVHJhbnNmZXIpKTtcbiAgICBwYkFjdGlvbkNvcmUuc2V0RGVwb3NpdHRvcmV3YXJkaW5nZnVuZChcbiAgICAgIHRvQWN0aW9uRGVwb3NpdFRvUmV3YXJkaW5nRnVuZCh0aGlzLmRlcG9zaXRUb1Jld2FyZGluZ0Z1bmQpXG4gICAgKTtcbiAgICBwYkFjdGlvbkNvcmUuc2V0Q2xhaW1mcm9tcmV3YXJkaW5nZnVuZChcbiAgICAgIHRvQWN0aW9uQ2xhaW1Gcm9tUmV3YXJkaW5nRnVuZCh0aGlzLmNsYWltRnJvbVJld2FyZGluZ0Z1bmQpXG4gICAgKTtcbiAgICBwYkFjdGlvbkNvcmUuc2V0R3JhbnRyZXdhcmQodG9BY3Rpb25HcmFudFJld2FyZCh0aGlzLmdyYW50UmV3YXJkKSk7XG5cbiAgICByZXR1cm4gcGJBY3Rpb25Db3JlO1xuICB9XG5cbiAgcHVibGljIGJ5dGVzdHJlYW0oKTogVWludDhBcnJheSB7XG4gICAgcmV0dXJuIHRoaXMuY29yZSgpLnNlcmlhbGl6ZUJpbmFyeSgpO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBTZWFsZWRFbnZlbG9wIHtcbiAgcHVibGljIGFjdDogRW52ZWxvcDtcbiAgcHVibGljIHNlbmRlclB1YktleTogQnVmZmVyO1xuICBwdWJsaWMgc2lnbmF0dXJlOiBCdWZmZXI7XG5cbiAgY29uc3RydWN0b3IoYWN0OiBFbnZlbG9wLCBzZW5kZXJQdWJLZXk6IEJ1ZmZlciwgc2lnbmF0dXJlOiBCdWZmZXIpIHtcbiAgICB0aGlzLmFjdCA9IGFjdDtcbiAgICB0aGlzLnNlbmRlclB1YktleSA9IHNlbmRlclB1YktleTtcbiAgICB0aGlzLnNpZ25hdHVyZSA9IHNpZ25hdHVyZTtcbiAgfVxuXG4gIHB1YmxpYyBieXRlc3RyZWFtKCk6IFVpbnQ4QXJyYXkge1xuICAgIGNvbnN0IHBiQWN0aW9uQ29yZSA9IHRoaXMuYWN0LmNvcmUoKTtcbiAgICBjb25zdCBwYkFjdGlvbiA9IG5ldyBhY3Rpb25QYi5BY3Rpb24oKTtcbiAgICBwYkFjdGlvbi5zZXRDb3JlKHBiQWN0aW9uQ29yZSk7XG4gICAgcGJBY3Rpb24uc2V0U2VuZGVycHVia2V5KHRoaXMuc2VuZGVyUHViS2V5KTtcbiAgICBwYkFjdGlvbi5zZXRTaWduYXR1cmUodGhpcy5zaWduYXR1cmUpO1xuICAgIHJldHVybiBwYkFjdGlvbi5zZXJpYWxpemVCaW5hcnkoKTtcbiAgfVxuXG4gIHB1YmxpYyBoYXNoKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIEJ1ZmZlci5mcm9tKGhhc2gyNTZiKHRoaXMuYnl0ZXN0cmVhbSgpKSkudG9TdHJpbmcoXCJoZXhcIik7XG4gIH1cblxuICBwdWJsaWMgYWN0aW9uKCk6IElBY3Rpb24ge1xuICAgIGNvbnN0IGdhc0xpbWl0ID0gdGhpcy5hY3QuZ2FzTGltaXQgfHwgXCIwXCI7XG4gICAgY29uc3QgZ2FzUHJpY2UgPSB0aGlzLmFjdC5nYXNQcmljZSB8fCBcIjBcIjtcblxuICAgIHJldHVybiB7XG4gICAgICBjb3JlOiB7XG4gICAgICAgIHZlcnNpb246IHRoaXMuYWN0LnZlcnNpb24sXG4gICAgICAgIG5vbmNlOiB0aGlzLmFjdC5ub25jZSxcbiAgICAgICAgZ2FzTGltaXQ6IGdhc0xpbWl0LFxuICAgICAgICBnYXNQcmljZTogZ2FzUHJpY2UsXG4gICAgICAgIHRyYW5zZmVyOiB0aGlzLmFjdC50cmFuc2ZlcixcbiAgICAgICAgZXhlY3V0aW9uOiB0aGlzLmFjdC5leGVjdXRpb24sXG4gICAgICAgIHN0YXJ0U3ViQ2hhaW46IHRoaXMuYWN0LnN0YXJ0U3ViQ2hhaW4sXG4gICAgICAgIHN0b3BTdWJDaGFpbjogdGhpcy5hY3Quc3RvcFN1YkNoYWluLFxuICAgICAgICBwdXRCbG9jazogdGhpcy5hY3QucHV0QmxvY2ssXG4gICAgICAgIGNyZWF0ZURlcG9zaXQ6IHRoaXMuYWN0LmNyZWF0ZURlcG9zaXQsXG4gICAgICAgIHNldHRsZURlcG9zaXQ6IHRoaXMuYWN0LnNldHRsZURlcG9zaXQsXG4gICAgICAgIGNyZWF0ZVBsdW1DaGFpbjogdGhpcy5hY3QuY3JlYXRlUGx1bUNoYWluLFxuICAgICAgICB0ZXJtaW5hdGVQbHVtQ2hhaW46IHRoaXMuYWN0LnRlcm1pbmF0ZVBsdW1DaGFpbixcbiAgICAgICAgcGx1bVB1dEJsb2NrOiB0aGlzLmFjdC5wbHVtUHV0QmxvY2ssXG4gICAgICAgIHBsdW1DcmVhdGVEZXBvc2l0OiB0aGlzLmFjdC5wbHVtQ3JlYXRlRGVwb3NpdCxcbiAgICAgICAgcGx1bVN0YXJ0RXhpdDogdGhpcy5hY3QucGx1bVN0YXJ0RXhpdCxcbiAgICAgICAgcGx1bUNoYWxsZW5nZUV4aXQ6IHRoaXMuYWN0LnBsdW1DaGFsbGVuZ2VFeGl0LFxuICAgICAgICBwbHVtUmVzcG9uc2VDaGFsbGVuZ2VFeGl0OiB0aGlzLmFjdC5wbHVtUmVzcG9uc2VDaGFsbGVuZ2VFeGl0LFxuICAgICAgICBwbHVtRmluYWxpemVFeGl0OiB0aGlzLmFjdC5wbHVtRmluYWxpemVFeGl0LFxuICAgICAgICBwbHVtU2V0dGxlRGVwb3NpdDogdGhpcy5hY3QucGx1bVNldHRsZURlcG9zaXQsXG4gICAgICAgIHBsdW1UcmFuc2ZlcjogdGhpcy5hY3QucGx1bVRyYW5zZmVyLFxuICAgICAgICBkZXBvc2l0VG9SZXdhcmRpbmdGdW5kOiB0aGlzLmFjdC5kZXBvc2l0VG9SZXdhcmRpbmdGdW5kLFxuICAgICAgICBjbGFpbUZyb21SZXdhcmRpbmdGdW5kOiB0aGlzLmFjdC5jbGFpbUZyb21SZXdhcmRpbmdGdW5kLFxuICAgICAgICBncmFudFJld2FyZDogdGhpcy5hY3QuZ3JhbnRSZXdhcmQsXG4gICAgICAgIHB1dFBvbGxSZXN1bHQ6IHRoaXMuYWN0LnB1dFBvbGxSZXN1bHRcbiAgICAgIH0sXG4gICAgICBzZW5kZXJQdWJLZXk6IHRoaXMuc2VuZGVyUHViS2V5LFxuICAgICAgc2lnbmF0dXJlOiB0aGlzLnNpZ25hdHVyZVxuICAgIH07XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGFzeW5jIHNpZ24oXG4gICAgYWNjb3VudDogSUFjY291bnQsXG4gICAgYWN0OiBFbnZlbG9wXG4gICk6IFByb21pc2U8U2VhbGVkRW52ZWxvcD4ge1xuICAgIGNvbnN0IGggPSBoYXNoMjU2YihhY3QuYnl0ZXN0cmVhbSgpKTtcbiAgICBpZiAoYWNjb3VudC5zaWduZXIpIHtcbiAgICAgIGNvbnN0IHNpZ25kRGF0YSA9IGF3YWl0IGFjY291bnQuc2lnbmVyLnNpZ24oYWNjb3VudC5hZGRyZXNzLCBoKTtcbiAgICAgIHJldHVybiBuZXcgU2VhbGVkRW52ZWxvcChcbiAgICAgICAgYWN0LFxuICAgICAgICBCdWZmZXIuZnJvbShzaWduZERhdGEucHVibGljS2V5LCBcImhleFwiKSxcbiAgICAgICAgc2lnbmREYXRhLmRhdGFcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHNpZ24gPSBCdWZmZXIuZnJvbShcbiAgICAgICAgbWFrZVNpZ25lcigwKShoLnRvU3RyaW5nKFwiaGV4XCIpLCBhY2NvdW50LnByaXZhdGVLZXkpLFxuICAgICAgICBcImhleFwiXG4gICAgICApO1xuICAgICAgcmV0dXJuIG5ldyBTZWFsZWRFbnZlbG9wKFxuICAgICAgICBhY3QsXG4gICAgICAgIEJ1ZmZlci5mcm9tKGFjY291bnQucHVibGljS2V5LCBcImhleFwiKSxcbiAgICAgICAgc2lnblxuICAgICAgKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==
